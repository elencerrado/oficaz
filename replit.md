# Oficaz - Employee Management System

## Overview

Oficaz is a comprehensive employee management system built with a modern full-stack architecture. The application provides time tracking, vacation management, document handling, messaging, and administrative features for companies and their employees.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Routing**: Wouter for client-side routing
- **Styling**: Tailwind CSS with shadcn/ui component library
- **State Management**: TanStack Query (React Query) for server state
- **Form Handling**: React Hook Form with Zod validation
- **Build Tool**: Vite for fast development and optimized builds

### Backend Architecture
- **Runtime**: Node.js with Express.js
- **Language**: TypeScript with ES modules
- **Database**: PostgreSQL with Drizzle ORM
- **Authentication**: JWT-based authentication with role-based access control
- **File Uploads**: Multer for handling document uploads
- **Session Management**: Express sessions with PostgreSQL store

### Database Design
- **ORM**: Drizzle with PostgreSQL dialect
- **Schema**: Type-safe schema definitions shared between frontend and backend
- **Tables**: Companies, Users, Work Sessions, Vacation Requests, Documents, Messages
- **Relationships**: Foreign key constraints with proper referential integrity

## Key Components

### Authentication System
- JWT token-based authentication
- Role-based access control (admin, manager, employee)
- Secure password hashing with bcrypt
- Token refresh mechanism
- Protected routes with middleware

### Time Tracking Module
- Real-time clock in/out functionality
- Automatic time calculation
- Work session history
- Weekly/monthly time summaries
- Company-wide time tracking (admin/manager view)

### Vacation Management
- Vacation request submission
- Approval workflow (pending → approved/denied)
- Vacation balance tracking
- Calendar integration for date selection
- Manager/admin approval interface

### Document Management
- File upload functionality
- Document categorization
- Secure file storage
- Download and deletion capabilities
- User-specific document access

### Messaging System
- Internal company messaging
- Real-time message updates
- Role-based message routing
- Message history and search

### Administrative Features
- Employee management (admin/manager only)
- Company settings configuration
- User role management
- System-wide statistics and reporting

## Data Flow

1. **Authentication Flow**: User credentials → JWT token → Role-based access
2. **Time Tracking Flow**: Clock in/out → Database update → Real-time UI refresh
3. **Vacation Request Flow**: Request submission → Manager review → Status update
4. **Document Flow**: File upload → Server storage → Database metadata
5. **Message Flow**: Compose → Send → Real-time delivery → Notification

## External Dependencies

### Frontend Dependencies
- **UI Components**: Radix UI primitives with shadcn/ui
- **Data Fetching**: TanStack Query for server state management
- **Date Handling**: date-fns for date manipulation
- **Form Validation**: Zod schema validation
- **Styling**: Tailwind CSS with custom Oficaz theme

### Backend Dependencies
- **Database**: Neon PostgreSQL serverless database
- **ORM**: Drizzle ORM with type-safe queries
- **Authentication**: JWT and bcrypt for security
- **File Handling**: Multer for multipart form data
- **Session Storage**: connect-pg-simple for PostgreSQL sessions

## Deployment Strategy

### Development Environment
- **Runtime**: Node.js 20 with TypeScript compilation
- **Database**: PostgreSQL 16 (Replit managed)
- **Dev Server**: Vite development server with HMR
- **Port Configuration**: Frontend on 5000, API on same port

### Production Build
- **Frontend**: Vite build with optimized assets
- **Backend**: esbuild compilation to ESM format
- **Static Assets**: Served from dist/public directory
- **Database Migrations**: Drizzle kit for schema management

### Replit Configuration
- **Modules**: nodejs-20, web, postgresql-16
- **Build Command**: `npm run build`
- **Start Command**: `npm run start`
- **Development**: `npm run dev`
- **Auto-scaling**: Configured for production deployment

## User Preferences

### Design Standards
- **Header Layout**: Always use consistent header format across admin pages:
  - Simple header with mb-6 margin (NO white background container)
  - px-6 py-4 min-h-screen bg-gray-50 with overflowX: 'clip'
  - h1 with text-2xl font-semibold text-gray-900 (simple title)
  - p with text-gray-500 mt-1 (descriptive subtitle)
  - Follow exact time-tracking.tsx pattern for consistency
- **User expects consistency**: Header and margins must follow the same pattern as time-tracking and other admin pages
- **No custom containers**: Always follow the px-6 py-4 pattern, never use max-w-7xl containers with border-bottom

### Code Protection Standards
- **Critical Functions Must Be Protected**: User has experienced functionality regression issues
- **Protected Code Sections**: Use ⚠️ PROTECTED comments with "DO NOT MODIFY" warnings
- **Document Classification**: The analyzeFileName function is CRITICAL and must remain stable
- **User Requirement**: "Blindfold" (protect/secure) critical functionality to prevent breaking changes
- **Protection Pattern**: Wrap critical functions with warning comments and clear boundaries

## Conceptos de Fechas en Sistema de Suscripciones

### Diferencia Crítica: Trial End vs Next Payment Date

El sistema maneja dos conceptos de fecha independientes que pueden divergir:

1. **trial_end_date**: Fecha límite cuando la web deja de ser operativa sin pago
   - Se establece al registro: trial_start_date + 14 días
   - NO se modifica una vez establecida
   - Determina cuándo bloquear acceso a la aplicación

2. **next_payment_date**: Fecha del próximo cobro de suscripción
   - Se calcula al confirmar método de pago
   - Si el usuario añade pago ANTES del trial_end_date: next_payment_date = trial_end_date + 1 mes
   - Si el usuario añade pago DESPUÉS del trial_end_date: next_payment_date = fecha_actual + 1 mes

### Escenarios Posibles:
- **Pago Puntual**: Trial expira 3 jul, usuario paga antes (25 jun) → cobro 3 agosto (mes siguiente al fin del trial)
- **Pago Tardío**: Trial expira 3 jul, usuario paga después (10 jul) → cobro 10 agosto (un mes desde que añadió pago)

### Estado Actual del Sistema:
- ✅ Base de datos con firstPaymentDate y nextPaymentDate separados
- ✅ Lógica de cálculo completa implementada en confirm-payment-method
- ✅ Esquema actualizado con campo first_payment_date
- ✅ Migración aplicada exitosamente
- ✅ Mensajes personalizados según escenario de pago

## Estado Actual del Sistema de Fichaje Admin

### PROBLEMA RESUELTO (28 Junio 2025)
- **Problema Original**: Usuario reporta errores al fichar desde dashboard admin
- **Causa Identificada**: Overflow numérico en campo totalHours por sesiones con fechas muy antiguas
- **Solución Implementada**: 
  - Validación de duración máxima 24 horas en endpoint clock-out
  - Verificación de fechas válidas (salida no anterior a entrada)
  - Limitación segura del campo totalHours (0-24 horas máximo)
  - Logs de debugging eliminados para versión de producción
- **Estado FINAL**: Sistema de fichaje admin completamente funcional y protegido contra overflow

### VISIBILIDAD DE FICHAJES ADMIN CORREGIDA (28 Junio 2025)
- **Problema**: Fichajes del admin no aparecían en página de control horario
- **Causa**: Filtro en time-tracking.tsx excluía sesiones con userRole === 'admin'
- **Solución**: Eliminado filtro restrictivo para incluir todas las sesiones
- **Resultado**: Admin ahora ve sus propios fichajes junto con los del equipo
- **Limpieza**: Eliminados registros de prueba del admin del día actual

## Changelog

- July 3, 2025. SISTEMA DE FACTURACIÓN PRORRATEADA IMPLEMENTADO COMPLETAMENTE: Cambios de plan con cobros y créditos automáticos
  - UPGRADE (Basic→Pro): Calcula diferencia prorrateada por días restantes del mes actual y cobra inmediatamente
  - DOWNGRADE (Pro→Basic): Calcula diferencia prorrateada y aplica crédito automático en próxima factura 
  - UMBRAL MÍNIMO: Solo procesa pagos/créditos superiores a €0.50 para evitar microtransacciones
  - MENSAJES DINÁMICOS: Sistema informa al usuario sobre cobros inmediatos, créditos aplicados o cambios en próximo ciclo
  - INTEGRACIÓN STRIPE: PaymentIntents automáticos para upgrades con método de pago por defecto
  - INTERFAZ MEJORADA: Modal de cambio de plan explica sistema de facturación inteligente y prorrateo
  - FUNCIONAMIENTO VERIFICADO: Cambio Pro→Basic completado exitosamente aplicando nueva configuración de funcionalidades
- July 3, 2025. SISTEMA DE FACTURAS STRIPE COMPLETAMENTE FUNCIONAL: Integración auténtica verificada y operativa
  - VERIFICADO: Endpoint `/api/account/invoices` funcionando correctamente con cliente Stripe real (cus_SbasUamcLJUPJ0)
  - SISTEMA LIMPIO: Eliminados logs de debugging tras confirmar operatividad completa
  - COMPORTAMIENTO NORMAL: Array vacío `[]` es respuesta correcta - facturas aparecen cuando Stripe procesa cobros reales
  - INTEGRACIÓN AUTÉNTICA: Sistema consulta directamente facturas de Stripe sin datos sintéticos
  - CICLO NATURAL: Facturas se generan automáticamente en ciclos de facturación mensuales de Stripe
  - FILTRADO INTELIGENTE: Solo muestra facturas con status 'paid' para mejor experiencia usuario
  - ARQUITECTURA SÓLIDA: Sistema preparado para mostrar facturas reales cuando Stripe las genere
- July 3, 2025. SISTEMA DE CAMBIO DE PLANES COMPLETAMENTE DINÁMICO: Endpoint usa tabla features como fuente primaria sin validaciones hardcodeadas
  - VALIDACIÓN DINÁMICA: Planes disponibles se obtienen dinámicamente desde subscription_plans en lugar de validación hardcodeada ['basic', 'pro']
  - TABLA FEATURES COMO FUENTE ÚNICA: Sistema usa columnas directas (basicEnabled, proEnabled, masterEnabled) tal como prefiere el usuario
  - CONSTRUCCIÓN AUTOMÁTICA: Features se construyen dinámicamente usando `${plan}_enabled` para cualquier plan existente
  - ENDPOINT UNIVERSAL: Funciona automáticamente con basic, pro, master o cualquier plan nuevo sin modificar código
  - VERIFICACIÓN EXITOSA: Plan master ahora funciona completamente (10→100 usuarios, todas las features habilitadas)
  - ARQUITECTURA LIMPIA: Sistema sin validaciones hardcodeadas, completamente basado en base de datos
- July 3, 2025. ARQUITECTURA DE FECHAS COMPLETAMENTE UNIFICADA: Sistema calculation dinámico desde companies.created_at implementado
  - ELIMINADOS: Campos redundantes startDate, trialStartDate de tabla subscriptions para simplificar esquema
  - FUENTE ÚNICA: companies.created_at es la única fecha de registro, todas las fechas se calculan dinámicamente
  - FUNCIÓN ACTUALIZADA: getSubscriptionByCompanyId calcula trial dates desde registration date + 14 días
  - ENDPOINT CORREGIDO: Company registration simplificado sin fechas duplicadas en subscription
  - CONSISTENCIA TOTAL: Registration date = trial start date, trial end = registration + 14 días
  - ARQUITECTURA LIMPIA: Eliminada complejidad de múltiples fechas sincronizadas manualmente
  - CÁLCULO DINÁMICO: trialEndDate = companies.created_at + 14 días, siempre preciso y consistente
- July 2, 2025. SISTEMA CUSTOM FEATURES POR EMPRESA IMPLEMENTADO COMPLETAMENTE: Override granular de features independiente del plan
  - BACKEND MEJORADO: getSubscriptionByCompanyId ahora combina features del plan + companies.customFeatures 
  - ENDPOINTS CREADOS: GET/PATCH /api/companies/custom-features para gestión de características personalizadas
  - BUG CRÍTICO RESUELTO: employee-time-tracking.tsx usaba employee_time_edit_permission en lugar de employee_time_edit
  - LÓGICA PERSONALIZACIÓN: Companies pueden habilitar/deshabilitar features específicas independientemente del plan
  - DEMOSTRACIÓN: Plan "pro" con employee_time_edit=false para mostrar restricciones por empresa
  - ARQUITECTURA DUAL: Subscription plan features como base + custom_features como override específico
- July 2, 2025. SISTEMA DE FEATURES Y MENÚ LATERAL COMPLETAMENTE CORREGIDO: Problemas críticos de acceso resueltos
  - CORREGIDO: Configuración ahora siempre accesible sin verificación de features (núcleo del sistema)
  - AGREGADA: Feature logoUpload a tabla features global con configuración pro_enabled=true, master_enabled=true
  - ACTUALIZADA: Suscripción empresa Pro incluye logoUpload en features JSON para funcionalidad completa
  - MAPEO CRÍTICO: checkFeatureAccess maneja correctamente mapping frontend→backend (timeTracking→time)
  - FEATURES CORE: Panel Principal, Configuración, Empleados siempre disponibles sin restricciones
  - RESULTADO: Sistema de restricciones completamente funcional con Pro plan teniendo acceso a logoUpload
- July 2, 2025. LIMPIEZA ESQUEMA COMPANIES COMPLETADA: Eliminadas columnas redundantes para usar datos corporativos unificados
  - ELIMINADAS: billing_name, billing_address, billing_city, tax_id de tabla companies
  - ACTUALIZADO MAPEO: billing_name→name, billing_address→address, billing_city→province, tax_id→cif  
  - FRONTEND CORREGIDO: settings.tsx usa cif, address, province en lugar de campos eliminados
  - BACKEND CORREGIDO: server/routes.ts usa campos unificados para datos de facturación de Stripe
  - MIGRACIÓN BD: Columnas eliminadas exitosamente con ALTER TABLE sin pérdida de datos
  - ARQUITECTURA SIMPLIFICADA: Un solo conjunto de campos corporativos para empresa Y facturación
- July 2, 2025. MIGRACIÓN EMPLOYEE_TIME_EDIT_PERMISSION COMPLETADA: Funcionalidad transferida completamente al sistema de features
  - ELIMINADO: Campo employeeTimeEditPermission de tabla companies y toda referencia en código
  - MIGRADO: Funcionalidad ahora controlada por employee_time_edit_permission en sistema de features
  - ACTUALIZADO: SubscriptionFeatures interface incluye nueva funcionalidad con mapeo Master plan
  - SIMPLIFICADO: Página settings ahora muestra mensaje informativo en lugar de formulario de configuración
  - UNIFICADO: Toda lógica de permisos ahora usa sistema único de features sin duplicación
  - CONSISTENCIA: employee-time-tracking.tsx usa hasAccess('employee_time_edit_permission') correctamente
  - ARQUITECTURA LIMPIA: Eliminada complejidad dual entre companies.* y features system
- July 2, 2025. SISTEMA DE FEATURES FINALIZADO CON COLUMNAS DIRECTAS: Arquitectura completamente simplificada
  - ELIMINACIÓN TABLA RELACIONAL: plan_features eliminada, ahora columnas directas (basicEnabled, proEnabled, masterEnabled) en features
  - MIGRACIÓN EXITOSA: Datos preservados desde plan_features a nuevas columnas (Basic: vacation+time+notifications, Pro: añade messages+documents+reminders, Master: todas)
  - SISTEMA DUAL SIMPLIFICADO: features con columnas por plan + companies.customFeatures para personalizaciones
  - ENDPOINTS OPTIMIZADOS: getAllSubscriptionPlans() usa columnas directas en lugar de JOIN complejos
  - PERSONALIZACIÓN UNIVERSAL: Cualquier empresa puede tener features custom independientemente del plan
  - BD ULTRA LIMPIA: Solo 2 elementos para features (tabla features con columnas por plan + customFeatures JSONB en companies)
  - ARQUITECTURA FINAL: Preferencia del usuario por columnas directas en lugar de tablas relacionales completamente implementada
- July 2, 2025. SISTEMA DE FEATURES COMPLETAMENTE REESTRUCTURADO: Migración exitosa de JSON a tablas relacionales
  - NUEVAS TABLAS: features, plan_features para gestión granular de funcionalidades por plan
  - MIGRACIÓN COMPLETA: Datos movidos desde subscription_plans.features a nuevas tablas relacionales
  - LANDING DINÁMICO: API público ahora incluye features reales desde nuevas tablas en lugar de JSON
  - FUNCIONALIDAD PRESERVADA: Toda la app mantiene funcionamiento idéntico con nuevo sistema de datos
- July 2, 2025. PRECIOS DINÁMICOS IMPLEMENTADOS EN LANDING PAGE: Sistema de precios desde base de datos completamente funcional
  - ENDPOINT PÚBLICO: /api/public/subscription-plans creado sin autenticación para landing page
  - PRECIOS EXACTOS: Landing page muestra valores precisos (19.99, 39.99, 99.90) sin redondeo
  - FALLBACK SEGURO: Sistema muestra "..." mientras carga o si falla la conexión
  - INTEGRACIÓN COMPLETA: Combina datos estáticos (descripción, features) con precios dinámicos de BD
  - ACTUALIZACIÓN AUTOMÁTICA: Precios se actualizan automáticamente al modificar super admin
- July 2, 2025. ICONO FLAMA IMPLEMENTADO CON COLORES POR PLAN: Crown reemplazado completamente por icono personalizado
  - IMPORTADO: Icono flama (icon flam_1751450814463.png) desde assets del usuario
  - FUNCIÓN COLORES: getPlanIconColor() para colores dinámicos según plan (basic=verde, pro=naranja, master=rojo)
  - FILTROS CSS: hue-rotate aplicado dinámicamente (basic=120deg, pro=40deg, master=340deg)
  - RELACIÓN ASPECTO: object-contain añadido para preservar proporciones originales del icono
  - TAMAÑO AUMENTADO: Display principal h-12 w-12 (48px), modal h-10 w-10 (40px) para mayor prominencia
  - ANIMACIÓN ENTRADA: animate-in zoom-in-95 duration-500 ease-out para efecto de aparición suave
  - UBICACIONES: Crown reemplazado en display principal de plan Y modal de cambio de plan
  - RESULTADO: Icono único personalizado con identidad visual diferenciada por nivel de plan
- July 2, 2025. LIMPIEZA DE CÓDIGO COMPLETADA: Elemento p innecesario eliminado de settings.tsx
  - ELIMINADO: Componente p redundante en línea 179-181 que mostraba información de fecha de fin del plan
  - INTERFAZ SIMPLIFICADA: Header de plan ahora solo muestra título sin información redundante de fechas
  - CÓDIGO MÁS LIMPIO: Eliminada lógica innecesaria que no aportaba valor al usuario
- July 2, 2025. POPUP PROFESIONAL IMPLEMENTADO: Dialog de shadcn/ui reemplaza alert() para límites de usuarios
  - ELIMINADO: alert() nativo reemplazado por Dialog profesional con iconos y estilo moderno
  - DISEÑO MEJORADO: Dialog con AlertTriangle icon, título claro "Límite de usuarios alcanzado"
  - UX PROFESIONAL: Descripción clara, mensaje en caja gris, botón "Entendido" ancho completo
  - FUNCIONALIDAD PRESERVADA: Misma validación preventiva pero con interfaz elegante
  - RESPONSIVE: Dialog adapta tamaño y funciona perfectamente en móvil y desktop
  - RESULTADO FINAL: Experiencia usuario mucho más profesional y consistente con el diseño de la app
- July 2, 2025. BUG CRÍTICO CAMPO max_users RESUELTO DEFINITIVAMENTE: Sistema validación límites usuarios 100% funcional
  - PROBLEMA RAÍZ: API `/api/account/subscription` devuelve snake_case (`max_users`) pero código accedía camelCase (`maxUsers`)
  - SOLUCIÓN APLICADA: Fallback seguro `max_users || maxUsers` en ambos botones (desktop + móvil)
  - VERIFICACIÓN EXITOSA: Validación funciona correctamente (49 límite vs 4 actuales = permite creación)
  - SISTEMA BLINDADO: Compatible con ambos formatos de datos para máxima estabilidad
  - RESULTADO FINAL: Validación preventiva inmediata protege límites de plan sin permitir entrada de datos
- July 2, 2025. BUG CRÍTICO ACCESO CAMPO max_users COMPLETAMENTE RESUELTO: Sistema de validación límites usuarios funcionando
  - PROBLEMA RESUELTO: Frontend accedía a campo inexistente `maxUsers` en lugar del campo real `max_users` de la base de datos
  - CAUSA TÉCNICA: Endpoint `/api/account/subscription` devuelve estructura raw con `max_users` pero frontend esperaba `maxUsers`
  - SOLUCIÓN APLICADA: Actualizado acceso a `(subscription as any)?.max_users || (subscription as any)?.maxUsers` en 3 ubicaciones
  - UBICACIONES CORREGIDAS: Botón desktop (línea 366), botón móvil (línea 393), y función handleCreateEmployee (línea 215)
  - VERIFICACIÓN EXITOSA: Modal ahora se abre correctamente, validación funciona con límite real (4 usuarios)
  - SISTEMA BLINDADO: Triple fallback asegura compatibilidad con diferentes estructuras de datos de endpoints
- July 2, 2025. BUG CRÍTICO VALIDACIÓN LÍMITES USUARIOS COMPLETAMENTE RESUELTO: Popup inmediato sin permitir entrada de datos
  - PROBLEMA RESUELTO: Usuario reporta que validación mostraba mensaje pero permitía seguir ingresando datos
  - VALIDACIÓN PREVENTIVA: Botones "Crear Usuario" ahora verifican límites ANTES de abrir modal
  - POPUP INMEDIATO: alert() nativo muestra mensaje de límite alcanzado sin permitir acceso al formulario
  - BLOQUEO TOTAL: Modal NO se abre cuando límite alcanzado, previniendo entrada de datos innecesaria
  - BACKEND+FRONTEND: Doble capa de seguridad con conteo correcto de TODOS los usuarios incluidos admins
  - AMBOS BOTONES: Desktop y móvil implementan misma validación preventiva para consistencia total
  - SISTEMA BLINDADO: Imposible bypassear límites desde frontend, backend también valida por seguridad
- July 2, 2025. BANNER MÓVIL PROFESIONAL IMPLEMENTADO: Diseño responsivo con tamaños consistentes y funcionalidad completa
  - TAMAÑOS CONSISTENTES: Fuente 13px título, 11px fecha, 12px contenido en móvil para legibilidad óptima
  - BOTONES PROFESIONALES: Altura 32px, "OK" botón 70px ancho mínimo, botón X cuadrado 32x32px
  - ICONOS UNIFORMES: CheckCircle y X consistentes en 14px para visibilidad clara
  - ANCHO CONTROLADO: Banner ocupa calc(100vw - 16px) sin desbordamiento horizontal
  - PADDING EQUILIBRADO: 12px interno, 8px gap entre elementos para diseño limpio
  - RESPONSIVE PERFECTO: Layout columna en móvil, fila en desktop con transiciones suaves
  - USABILIDAD TÁCTIL: Botones con tamaño mínimo para interacción táctil fácil en móviles
  - RESULTADO FINAL: Banner profesional que funciona perfectamente en todas las pantallas
- July 2, 2025. COMPACTACIÓN MÓVIL COMPLETADA: Banner de recordatorios ultra compacto para dispositivos móviles
  - PADDING REDUCIDO: De 16px a 12px en móvil para menor ocupación de espacio
  - GAPS MINIMIZADOS: Entre elementos reducidos de 12px a 8px (header) y 6px a 4px (botones)
  - ICONOS COMPACTOS: Tamaño reducido de 14px a 12px en móvil con padding de círculo reducido
  - TIPOGRAFÍA MICRO: Título 14px→13px, fecha 11px→10px, contenido 13px→12px en móvil
  - BOTONES MINIMALISTAS: Padding 6px/10px→4px/8px, fuente 11px→10px, gap interno 3px→2px
  - ALTURA CONTENIDO: Limitada a 40px (desde 60px) para evitar expansión vertical
  - ICONOS X: Reducidos a 10px en móvil para máxima compactación
  - RESULTADO: Banner que cabe completamente en pantallas móviles sin overflow horizontal
- July 2, 2025. BOTONES MÓVILES EQUILIBRADOS FINALIZADOS: Balance perfecto entre compacto y usable
  - TAMAÑO ÓPTIMO: Botones de 20px altura con padding 3px/6px para buena usabilidad táctil
  - ANCHO CONTROLADO: Botón OK máximo 45px, botón X máximo 24px sin ser demasiado estrechos
  - TIPOGRAFÍA LEGIBLE: Fuente 10px en móvil, texto "OK" mantiene legibilidad
  - ICONOS PROPORCIONADOS: CheckCircle y X de 10px en móvil para visibilidad adecuada
  - BORDES SUAVES: borderRadius 4px en móvil para estética moderna pero accesible
  - RESULTADO FINAL: Botones compactos pero usables que no frustran al usuario en móvil
- July 2, 2025. OPTIMIZACIÓN DE RESPONSIVIDAD COMPLETADA: useIsMobile hook implementado en ReminderBanner
  - REEMPLAZADAS: Todas las referencias a window.innerWidth <= 768 en reminder-banner.tsx por hook useIsMobile()
  - COMPATIBILIDAD SSR: Eliminadas llamadas directas a window.innerWidth para mejor server-side rendering
  - HOOK CENTRALIZADO: Lógica de detección móvil unificada con debounce para mejor rendimiento
  - RESPONSIVE OPTIMIZADO: Paddings, tamaños de fuente, gaps y botones adaptativos usando variable isMobile
  - CONSISTENCIA TÉCNICA: Patrón establecido para futuros componentes que requieran detección móvil
- July 1, 2025. BUG CRÍTICO DE CONTEXTO DE AUTENTICACIÓN RESUELTO: Sistema de avatares completamente funcional
  - PROBLEMA IDENTIFICADO: Dashboard empleado no actualizaba avatar tras cambio de foto por contexto de autenticación estático
  - CAUSA TÉCNICA: useAuth no refrescaba datos del usuario después de mutaciones de foto de perfil
  - SOLUCIÓN IMPLEMENTADA: Función refreshUser() agregada al contexto de autenticación
  - INTEGRACIÓN COMPLETADA: UserAvatar ahora llama refreshUser() tras upload/delete exitoso
  - RESULTADO FINAL: Cambios de avatar se reflejan inmediatamente en dashboard y toda la aplicación
  - TÉCNICA APLICADA: Actualización de localStorage + estado de React + invalidación de cache
- July 1, 2025. COMPRESIÓN AUTOMÁTICA DE IMÁGENES IMPLEMENTADA: Todas las fotos de perfil se procesan automáticamente
  - SHARP INTEGRADO: Librería profesional para procesamiento de imágenes instalada y configurada
  - TAMAÑO MÁXIMO: Todas las imágenes se redimensionan automáticamente a máximo 200x200 píxeles
  - CALIDAD OPTIMIZADA: JPEG a 85% de calidad con progressive encoding para carga rápida
  - ASPECT RATIO PRESERVADO: fit: 'inside' mantiene proporciones sin distorsión
  - NO AGRANDAMIENTO: withoutEnlargement evita pixelado en imágenes pequeñas
  - FORMATO CONSISTENTE: Todas las fotos se convierten a JPEG para uniformidad
  - RENDIMIENTO MEJORADO: Archivos más pequeños mejoran velocidad de carga en toda la aplicación
  - LIMPIEZA AUTOMÁTICA: Archivos originales se eliminan tras procesamiento para ahorrar espacio
- July 1, 2025. AVATAR PERFIL EMPLEADO OPTIMIZADO: Tamaño ajustado a 80px tras feedback del usuario
  - TAMAÑO AJUSTADO: Avatar en perfil empleado reducido a 80px (w-20 h-20) para proporción perfecta
  - BOTONES DUPLICADOS ELIMINADOS: Removidos botones externos de upload/delete, UserAvatar ya los incluye
  - DETECCIÓN AUTOMÁTICA: UserAvatar detecta w-20/w-32/w-64 en className para tamaños 80px/128px/256px
  - SISTEMA UNIFICADO: Solo UserAvatar con showUpload=true, sin controles externos adicionales
  - VERIFICACIÓN COMPLETA: Foto de Juan José carga correctamente con círculo de fondo único
  - RESULTADO FINAL: Avatar con tamaño apropiado y funcionalidad completa integrada
- July 1, 2025. SISTEMA DE AVATARES PERFECCIONADO: Círculos de fondo únicos con fotos encima y funcionalidad completa
  - IMPLEMENTADO: Círculo de fondo con color único por empleado (posición absoluta z-index 1)
  - FOTOS ENCIMA: Imagen de avatar posicionada sobre el fondo con padding de 3px (z-index 2)
  - FUNCIONALIDAD UPLOAD: Botones de subir y eliminar foto funcionando con cambios instantáneos
  - ESTADO LOCAL: Usuario ve cambios inmediatos sin recargar página usando localProfilePicture
  - FALLBACK ROBUSTO: Canvas local cuando falla servicio externo UI Avatars
  - ELIMINADO: Punto verde de estado online del perfil de empleado por solicitud del usuario
  - RESULTADO FINAL: Sistema visual atractivo con colores únicos + fotos + upload instantáneo
- July 1, 2025. BUG CRÍTICO DE TRANSFORMACIÓN DE DATOS RESUELTO: Campo profilePicture perdido en agrupación
  - PROBLEMA IDENTIFICADO: time-tracking.tsx perdía campo profilePicture durante agrupación de sesiones por día
  - CAUSA TÉCNICA: Línea 1720 no incluía profilePicture en objeto de agrupación sessionsByDay
  - SOLUCIÓN APLICADA: Agregado profilePicture: session.profilePicture a lógica de agrupación
  - VERIFICACIÓN: Andrés González ahora muestra foto consistentemente en fichajes y vacaciones
  - SISTEMA BLINDADO: Avatar photo-only funcionando correctamente en toda la aplicación
- July 1, 2025. SISTEMA DE AVATARES COMPLETAMENTE REDISEÑADO: Solo avatares tipo foto en toda la aplicación
  - ELIMINADOS AVATARES DE INICIALES: Ya no existen divs con texto, todo son imágenes
  - SISTEMA UNIFICADO: profilePicture real o avatar generado automáticamente con UI Avatars API
  - COLORES ÚNICOS PRESERVADOS: Servicio externo usa los colores distintivos de cada empleado
  - FALLBACK ROBUSTO: Canvas local como backup si falla servicio externo
  - APARIENCIA PROFESIONAL: Todos los avatares tienen look de "foto" consistente
  - APLICADO EN TODA LA APP: Fichajes, mensajes, empleados, vacaciones - sistema 100% foto
- July 1, 2025. INCONSISTENCIA VISUAL DE AVATARES CORREGIDA DEFINITIVAMENTE: Estructura unificada implementada
  - PROBLEMA RESUELTO: Avatar sin foto (línea 235) ahora usa misma estructura que avatar con foto (línea 189)
  - ESTRUCTURA UNIFICADA: Ambos tipos usan contenedor exterior (borde+padding+fondo blanco) + contenedor interior
  - ESTÉTICA CONSISTENTE: Eliminada diferencia visual entre avatares con/sin foto en fichajes admin
  - SISTEMA BLINDADO: Todos los avatares en aplicación siguen exactamente la misma lógica visual
  - RESULTADO FINAL: Perfecta armonía visual entre avatares con fotos reales vs iniciales de colores
- July 1, 2025. SISTEMA DE AVATARES COMPLETAMENTE FINALIZADO: Display de fotos de perfil funcional en toda la aplicación
  - COMPLETADAS TODAS LAS CORRECCIONES: Todas las instancias de UserAvatar ahora incluyen profilePicture prop
  - PÁGINAS ACTUALIZADAS: messages.tsx (8 instancias), vacation-management.tsx, mobile-header.tsx, messages-backup.tsx (3 instancias)
  - SISTEMA UNIFICADO: Display consistente de fotos de perfil vs iniciales de colores en toda la aplicación
  - FUNCIONALIDAD COMPLETA: Avatares muestran fotos reales cuando están disponibles o fallback a iniciales con colores únicos
  - VERIFICACIÓN EXITOSA: Confirmado que no quedan instancias sin profilePicture prop en el sistema
  - PATRÓN TÉCNICO: profilePicture={user?.profilePicture} aplicado sistemáticamente en todos los componentes UserAvatar
- July 1, 2025. BOTÓN "DESCARGAR DATOS" ELIMINADO: Removido de página de configuración según solicitud del usuario
  - ELIMINADO: Botón "Descargar datos de la empresa" de sección Gestión de cuenta
  - SIMPLIFICACIÓN: Solo queda botón "Cambiar plan de suscripción" en opciones avanzadas
  - INTERFAZ MÁS LIMPIA: Reducida complejidad innecesaria en página de configuración
- July 1, 2025. SISTEMA DE ESTADO LOCAL PARA AVATARES COMPLETADO: Cambios inmediatos sin recargar página
  - IMPLEMENTADO: useState para localProfilePicture en componente UserAvatar
  - MUTACIONES OPTIMIZADAS: Upload y delete actualizan estado local inmediatamente
  - RENDERIZADO INMEDIATO: Todas las imágenes usan estado local en lugar de props
  - BOTONES DINÁMICOS: Aparecen/desaparecen según estado local sin delay
  - UX MEJORADA: Cambios de avatar visibles instantáneamente en toda la aplicación
- July 1, 2025. TAMAÑOS DE AVATARES UNIFICADOS COMPLETAMENTE: Sistema estandarizado a 40px para máxima consistencia
  - PROBLEMA RESUELTO: Diferencias de tamaño entre páginas (fichajes vs vacaciones vs mensajes)
  - SOLUCIÓN TÉCNICA: UserAvatar ahora usa tamaño fijo 40px independientemente del prop size
  - RESULTADO: Todos los avatares (sm/md/lg) ahora tienen dimensiones idénticas 40x40px
  - MEJORA VISUAL: Tamaño aumentado de 30-44px a 40px uniforme para mejor visibilidad
  - CONSISTENCIA TOTAL: Mismas dimensiones en fichajes, vacaciones, mensajes, empleados y todas las páginas
- July 1, 2025. BUG CRÍTICO DE TRANSFORMACIÓN DE DATOS RESUELTO: Campo profilePicture perdido en agrupación
  - PROBLEMA IDENTIFICADO: time-tracking.tsx perdía campo profilePicture durante agrupación de sesiones por día
  - CAUSA TÉCNICA: Línea 1720 no incluía profilePicture en objeto de agrupación sessionsByDay
  - SOLUCIÓN APLICADA: Agregado profilePicture: session.profilePicture a lógica de agrupación
  - VERIFICACIÓN: Andrés González ahora muestra foto consistentemente en fichajes y vacaciones
  - SISTEMA BLINDADO: Avatar photo-only funcionando correctamente en toda la aplicación
- July 1, 2025. SISTEMA DE AVATARES COMPLETAMENTE REDISEÑADO: Solo avatares tipo foto en toda la aplicación
  - ELIMINADOS AVATARES DE INICIALES: Ya no existen divs con texto, todo son imágenes
  - SISTEMA UNIFICADO: profilePicture real o avatar generado automáticamente con UI Avatars API
  - COLORES ÚNICOS PRESERVADOS: Servicio externo usa los colores distintivos de cada empleado
  - FALLBACK ROBUSTO: Canvas local como backup si falla servicio externo
  - APARIENCIA PROFESIONAL: Todos los avatares tienen look de "foto" consistente
  - APLICADO EN TODA LA APP: Fichajes, mensajes, empleados, vacaciones - sistema 100% foto
- July 1, 2025. INCONSISTENCIA VISUAL DE AVATARES CORREGIDA DEFINITIVAMENTE: Estructura unificada implementada
  - PROBLEMA RESUELTO: Avatar sin foto (línea 235) ahora usa misma estructura que avatar con foto (línea 189)
  - ESTRUCTURA UNIFICADA: Ambos tipos usan contenedor exterior (borde+padding+fondo blanco) + contenedor interior
  - ESTÉTICA CONSISTENTE: Eliminada diferencia visual entre avatares con/sin foto en fichajes admin
  - SISTEMA BLINDADO: Todos los avatares en aplicación siguen exactamente la misma lógica visual
  - RESULTADO FINAL: Perfecta armonía visual entre avatares con fotos reales vs iniciales de colores
- July 1, 2025. SISTEMA DE AVATARES COMPLETAMENTE FINALIZADO: Display de fotos de perfil funcional en toda la aplicación
  - COMPLETADAS TODAS LAS CORRECCIONES: Todas las instancias de UserAvatar ahora incluyen profilePicture prop
  - PÁGINAS ACTUALIZADAS: messages.tsx (8 instancias), vacation-management.tsx, mobile-header.tsx, messages-backup.tsx (3 instancias)
  - SISTEMA UNIFICADO: Display consistente de fotos de perfil vs iniciales de colores en toda la aplicación
  - FUNCIONALIDAD COMPLETA: Avatares muestran fotos reales cuando están disponibles o fallback a iniciales con colores únicos
  - VERIFICACIÓN EXITOSA: Confirmado que no quedan instancias sin profilePicture prop en el sistema
  - PATRÓN TÉCNICO: profilePicture={user?.profilePicture} aplicado sistemáticamente en todos los componentes UserAvatar
- July 1, 2025. BUG CRÍTICO DE DISPLAY DE ROLES EN CHAT RESUELTO: Sistema de mensajes empleado completamente funcional
  - PROBLEMA RESUELTO: Admin Andrés aparecía como "sin cargo definido" en chat de empleados
  - CAUSA IDENTIFICADA: Múltiples ubicaciones usaban campos inexistentes (jobTitle, position) en base de datos
  - SOLUCIÓN APLICADA: Sistema ahora usa campo position dinámico del perfil con fallback inteligente
  - BACKEND CORREGIDO: /api/managers endpoint ahora incluye campo position para datos completos
  - FRONTEND CORREGIDO: Todas las ubicaciones usan position || fallback role-based descriptions
  - MAPEO ESPAÑOL FALLBACK: admin="Director General", manager="Responsable", employee="Empleado"
  - UBICACIONES CORREGIDAS: getRoleDisplay función, lista de managers, header de chat individual
  - FUNCIONALIDAD RESTAURADA: Chat muestra cargo real del perfil o fallback según rol
  - SISTEMA VERIFICADO: Roles dinámicos funcionando correctamente en todas las vistas del chat
- June 30, 2025. BUG CRÍTICO DE DESCARGA DE DOCUMENTOS RESUELTO: Sistema empleado completamente funcional
  - PROBLEMA RESUELTO: Error "invalid or expired token" en descarga de documentos empleado
  - CAUSA IDENTIFICADA: Frontend enviaba token por query param pero backend solo aceptaba headers Authorization
  - MIDDLEWARE CREADO: authenticateTokenOrQuery permite autenticación por header o query parameter
  - ENDPOINT CORREGIDO: /api/documents/:id/download ahora acepta ?token=${token} para descargas directas
  - FUNCIONALIDAD EMPLEADO: Descarga y visualización de documentos funcionando correctamente
- June 30, 2025. BUG CRÍTICO DE ELIMINACIÓN PERMANENTE RESUELTO: Sistema super admin completamente funcional
  - PROBLEMA RESUELTO: Error en eliminación permanente por tablas inexistentes (document_notifications, custom_holidays)
  - ENDPOINT CORREGIDO: /api/super-admin/companies/:id/delete-permanently actualizado para usar solo tablas existentes
  - SISTEMA VERIFICADO: Eliminación completa funciona correctamente eliminando datos en cascada
  - STATUS BADGES CORREGIDOS: Empresas trial ahora muestran "Prueba" (azul), activas "Activo" (verde), inactivas "Inactivo" (gris)
  - FUNCIONALIDAD COMPLETA: Super admin puede eliminar empresas permanentemente sin errores de base de datos
- June 30, 2025. UNIFICACIÓN DE EMAIL CORPORATIVO Y FACTURACIÓN COMPLETADA: Sistema completamente coherente implementado
  - BACKEND UNIFICADO: billing_email ahora usa directamente company.email eliminando fallbacks complejos
  - STRIPE INTEGRADO: Endpoints create-setup-intent y confirm-payment-method usan company.email para customers
  - FRONTEND ACTUALIZADO: Ambas páginas (registro y configuración) usan "Email corporativo / facturación" como label
  - TERMINOLOGÍA COHERENTE: Sistema clarifica que el email de empresa sirve para comunicaciones Y facturación
  - EXPLICACIÓN AÑADIDA: Texto descriptivo en registro explica el uso dual del email corporativo
  - CONSISTENCIA TOTAL: Ya no existe separación entre email empresa vs email facturación
  - SIMPLIFICACIÓN LOGICA: Eliminada complejidad de fallbacks (admin?.companyEmail || admin?.personalEmail || company.email)
  - FACTURAS STRIPE: Todas las facturas de Stripe ahora usan el email corporativo unificado (info@test.com)
- June 30, 2025. CONSOLIDACIÓN DE BASE DE DATOS COMPLETADA: Eliminación definitiva de tabla company_configs
  - MIGRACIÓN EXITOSA: Todos los datos de configuración de empresa movidos a tabla companies
  - BACKEND ACTUALIZADO: Todas las funciones ahora usan companies table directamente
  - TABLA ELIMINADA: company_configs completamente removida de la base de datos usando DROP TABLE
  - SISTEMA LIMPIO: Ya no existen referencias a company_config en código ni base de datos
  - FUNCIONALIDAD PRESERVADA: Cálculos de vacaciones y configuraciones funcionando normalmente
  - CONSOLIDACIÓN TOTAL: Arquitectura simplificada con una sola tabla para datos de empresa
- June 30, 2025. TAMAÑOS DE AVATARES FINALMENTE AJUSTADOS: Equilibrio perfecto entre visibilidad y proporción
  - ITERACIÓN FINAL: Ajustados a tamaños óptimos tras feedback del usuario para mejor visibilidad
  - TAMAÑOS DEFINITIVOS: sm=30px, md=36px, lg=44px (equilibrio entre compacto y visible)
  - FUENTES OPTIMIZADAS: sm=12px, md=13px, lg=15px para legibilidad perfecta
  - BORDES MANTIENEN PROPORCIÓN: 2px para sm/md, 3px para lg
  - RESULTADO FINAL: Avatares con visibilidad óptima sin ser demasiado grandes para la UI
- June 30, 2025. PROBLEMA CRÍTICO DE COMANDOS SED SOLUCIONADO: Restauración precisa de tamaños de botones completada
  - CAUSA IDENTIFICADA: Comando sed anterior cambió accidentalmente Button components de size="sm" a size="md"
  - SOLUCIÓN APLICADA: Corrección selectiva para restaurar solo Button components a size="sm" manteniendo UserAvatar size="md"
  - MÉTODO UTILIZADO: Comando sed específico para Button con patrón /Button/,/onClick/ para precision quirúrgica
  - AVATARES PRESERVADOS: Todos los UserAvatar mantienen correctamente size="md" según estándar unificado
  - RESULTADO FINAL: Botones con size="sm" para UI compacta, avatares con tamaños optimizados
  - LECCIÓN TÉCNICA: Los comandos sed requieren patrones precisos para evitar efectos colaterales en componentes similares
- June 30, 2025. SISTEMA DE AVATARES COMPLETAMENTE UNIFICADO: Consistencia total de tamaños y formas garantizada
  - PROBLEMA RAÍZ IDENTIFICADO: Componente Avatar de shadcn/ui tenía tamaño fijo h-10 w-10 (40px) vs UserAvatar dinámico (32px/40px/48px)
  - SOLUCIÓN DEFINITIVA: Aplicadas propiedades anti-deformación idénticas a componente Avatar de shadcn
  - PROPIEDADES CRÍTICAS AÑADIDAS: min-w/min-h/max-w/max-h-[40px], flexShrink: 0, aspectRatio: '1'
  - LIMPIEZA DE CÓDIGO: Eliminadas importaciones innecesarias de Avatar en mobile-header.tsx y employees-simple.tsx
  - CONSISTENCIA GARANTIZADA: Ambos sistemas de avatares (UserAvatar y shadcn Avatar) ahora perfectamente alineados
  - SISTEMA BLINDADO: Resistente a deformaciones por CSS externo en cualquier contexto de layout
  - RESULTADO FINAL: Tamaños uniformes y formas circulares perfectas en toda la aplicación
- June 30, 2025. PROBLEMA CRÍTICO DE AVATARES ELÍPTICOS RESUELTO: Refuerzo anti-deformación implementado
  - PROBLEMA IDENTIFICADO: UserAvatar se deformaba a elipses en pantallas pequeñas por layout constraints
  - SOLUCIÓN ROBUSTA: Agregadas propiedades CSS críticas para mantener forma circular perfecta:
    * minWidth/minHeight/maxWidth/maxHeight para evitar compresión por contenedores padre
    * flexShrink: 0 para prevenir encogimiento automático en flex containers
    * aspectRatio: '1' para forzar ratio 1:1 perfecto en navegadores modernos
  - APLICADO EN TODOS LOS CONTEXTOS: Avatar simple, avatar con upload, y contenedores internos
  - BLINDAJE COMPLETO: Sistema resistente a cualquier CSS externo que pueda afectar dimensiones
  - TAMAÑOS GARANTIZADOS: sm=32px, md=40px, lg=48px siempre circulares sin deformación
- June 28, 2025. SISTEMA DE AVATARES FINALMENTE PERFECCIONADO: Tamaño dinámico implementado completamente
  - TAMAÑO DINÁMICO IMPLEMENTADO: UserAvatar ahora usa sizeConfig dinámico en lugar de valores hardcodeados
  - ESCALADO CORRECTO: size="sm" (32px), size="md" (40px), size="lg" (48px) funcionando perfectamente
  - FUENTES ADAPTATIVAS: fontSize también escalable según tamaño (12px, 14px, 16px)
  - COMPONENTE ROBUSTO: Lógica unificada para fotos con bordes de colores e iniciales con fondos de colores
  - VERIFICACIÓN COMPLETA: Todas las páginas usando UserAvatar correctamente sin implementaciones manuales restantes
  - SISTEMA BLINDADO: Estilos inline puros eliminan dependencias CSS que puedan interferir
  - FUNCIONALIDAD UPLOAD: Sistema de carga de fotos integrado con fallback automático a iniciales
  - COLORES ÚNICOS: Hash por userId garantiza colores distintivos permanentes por empleado
- June 28, 2025. DATE PICKER REDISEÑADO: Sistema calendario implementado siguiendo solicitud del usuario
  - CAMBIO CRÍTICO: DatePickerDay ahora usa formato calendario (Dialog + Calendar) igual al filtro de rango
  - DatePickerDayEmployee mantiene formato dropdown exclusivamente para fechas de incorporación
  - Distinción clara: calendario para fechas generales, dropdown solo para incorporación de empleados
  - Estructura idéntica al DatePickerPeriod con Dialog, Calendar mode="single" y botones Cancelar/Limpiar
  - Implementado según énfasis del usuario: "calendario normal!!!!" para máxima usabilidad
- June 28, 2025. AVATARES ÚNICOS FINALMENTE FUNCIONANDO: Solución definitiva con estilos inline puros
  - PROBLEMA CRÍTICO RESUELTO: shadcn/ui CSS causaba interferencias, eliminado TODO uso de clases CSS
  - UserAvatar completamente reescrito: solo estilos inline style={{}} sin ninguna clase
  - 18 colores únicos garantizados: userId determina color hexadecimal directo (#3B82F6, #10B981, etc)
  - Tamaños fijos en pixeles: 32px/40px/48px sin clases responsive que puedan interferir
  - Especificidad máxima: estilos inline no pueden ser sobrescritos por CSS externo alguno
  - Sistema blindado: sin dependencias de Tailwind o shadcn que puedan causar regresiones futuras
- June 28, 2025. SISTEMA DE AVATARES ÚNICOS COMPLETAMENTE FINALIZADO: Todas las instancias corregidas exitosamente
  - MESSAGES.TSX COMPLETAMENTE CORREGIDO: 8 instancias de UserAvatar actualizadas sistemáticamente
  - Eliminadas TODAS las className personalizadas que bloqueaban el sistema de colores únicos
  - Correcciones en líneas: 543, 574, 732, 771, 982, 1095, 1162 con userId prop aplicado
  - Sistema hash por userId funcionando perfectamente en toda la aplicación
  - TODAS LAS PÁGINAS UNIFICADAS: time-tracking, messages, employees, vacation-management usando colores únicos
  - UserAvatar ahora genera colores automáticamente por userId sin interferencias de className
  - Sistema completamente estable: cada empleado mantiene color distintivo permanente en todas las vistas
- June 28, 2025. PROBLEMA CRÍTICO DE COLORES DE AVATARES RESUELTO: Sistema completamente funcional
  - PROBLEMA CRÍTICO SOLUCIONADO: Color oficaz-primary agregado directamente a tailwind.config.ts 
  - Definición HSL correcta implementada: hsl(211, 100%, 50%) en configuración de Tailwind
  - Sistema de avatares UserAvatar funcionando consistentemente con color azul corporativo #007AFF
  - Avatar añadido junto al nombre en tabla de fichajes de time-tracking.tsx con size="sm"
  - Importación correcta de UserAvatar agregada a time-tracking.tsx
  - Todos los avatares ahora muestran color uniforme y consistente en toda la aplicación
- June 28, 2025. COMPONENTE USERAVATAR OPTIMIZADO Y AVATARES REEMPLAZADOS COMPLETAMENTE: Sistema de avatares unificado
  - COMPONENTE USERAVATAR MEJORADO: Lógica simplificada para aplicar correctamente colores personalizados sin conflictos
  - REEMPLAZADOS 8 AVATARES EN MENSAJES: Chat header, lista empleados, modal empleados, modal managers, chat móvil
  - COLORES PERSONALIZADOS PRESERVADOS: bg-oficaz-primary text-white, bg-white/20 text-white según contexto
  - LÓGICA CONDICIONAL OPTIMIZADA: className personalizada tiene prioridad completa sobre colores por defecto
  - ELIMINADOS COLORES POR DEFECTO PROBLEMÁTICOS: ya no interfieren con especificaciones personalizadas
  - COMPONENTE ROBUSTO: maneja casos con y sin className de forma inteligente y consistente
  - SISTEMA DE AVATARES UNIFICADO: todas las páginas ahora usan UserAvatar en lugar de implementaciones manuales
- June 28, 2025. FALSAS DETECCIONES DE FECHAS CORREGIDAS DEFINITIVAMENTE: Sistema de análisis perfectamente blindado
  - PROBLEMA CRÍTICO RESUELTO: "mar" en apellidos como "Martín" era detectado como "marzo" agregando fechas falsas
  - CAUSA IDENTIFICADA: Expresión regular detectaba "mar" en "Marti" interpretándolo como abreviatura de marzo
  - SOLUCIÓN TÉCNICA APLICADA: 
    * Eliminada abreviatura "mar" del mapeo de meses para evitar falsos positivos
    * Detección de meses numéricos solo con separadores explícitos (guiones, espacios)
    * Búsqueda de palabras completas con límites (\b) para nombres de meses
    * Limpieza de separadores antes de mapear números a meses
  - RESULTADO VERIFICADO: "Contrato - Juan José Ramirez Marti.pdf" → "Contrato - Juan José Ramirez Martín.pdf" SIN "Marzo 2025"
  - FUNCIÓN PROTEGIDA: generateCleanFileName blindada con comentarios ⚠️ PROTECTED contra futuras regresiones
  - DETECCIÓN DE MESES PROTEGIDA: Lógica crítica de monthMatch documentada y blindada
  - SISTEMA ROBUSTO: Análisis inteligente funcionando sin interferencias de nombres de personas
- June 28, 2025. ANALIZADOR DE DOCUMENTOS COMPLETAMENTE RESTAURADO: Sistema inteligente funcionando perfectamente
  - PROBLEMA CRÍTICO RESUELTO: Lista vacía en analizador de documentos por logs de debugging que interferían
  - Función analyzeFileName restaurada a versión limpia sin logs que bloqueaban la detección
  - Detección automática funcionando: "nomina junio 2025 - juan jose ramirez.pdf" → "Nómina" + empleado correcto
  - Sistema completo: detecta tipos de documento (Nómina, Contrato, Justificante, DNI, Otros) y empleados
  - Generación de nombres limpios funcionando: formato "Tipo - Empleado - Fecha.extensión"
  - Modal de análisis inteligente mostrando correctamente todos los archivos seleccionados
  - Eliminados todos los logs de debugging que causaban interferencias en producción
- June 28, 2025. AUTO-SCROLL DEL CHAT CORREGIDO DEFINITIVAMENTE: Métodos múltiples para todos los contenedores
  - PROBLEMA CRÍTICO RESUELTO: Auto-scroll implementado con 3 métodos simultáneos para máxima compatibilidad
  - MÉTODO 1: messagesEndRef.scrollIntoView() como método principal directo
  - MÉTODO 2: Seleccores CSS específicos para cada vista:
    * Vista admin desktop: `.flex-1.overflow-y-auto.p-4.bg-gray-50`
    * Vista admin móvil: `.flex-1.overflow-y-auto.px-4.bg-gray-50`
    * Vista empleado: `.min-h-screen.bg-employee-gradient .overflow-y-auto`
  - MÉTODO 3: messagesContainerRef.current.scrollTop para referencias directas
  - Sistema robusto: múltiples intentos de scroll para garantizar funcionamiento en todos los layouts
  - Aplicado tanto en useEffect (mensajes nuevos) como en sendMessage (envío manual)
  - DOCUMENTADO PARA FUTURAS REFERENCIAS: problema recurrente resuelto con enfoque exhaustivo
- June 28, 2025. AUTO-SCROLL DEL CHAT RESTAURADO COMPLETAMENTE: Función robusta con múltiples contenedores
  - PROBLEMA CRÍTICO RESUELTO: Auto-scroll perdido otra vez en chat empleado (línea 572 messages.tsx)
  - Función de scroll mejorada con 6 selectores diferentes para encontrar contenedor correcto
  - Logs de debugging añadidos para detectar problemas futuros con contenedores de mensajes
  - Auto-scroll forzado también al enviar mensaje (500ms delay) para asegurar funcionamiento
  - Sistema PROTEGIDO con comentarios ⚠️ para prevenir regresiones futuras
  - Funciona tanto en vista móvil como desktop, empleado y admin
- June 28, 2025. LÓGICA DE MENSAJES DE PAGO COMPLETAMENTE REFINADA: Sistema inteligente según estado exacto
  - CASO 1: Sin método de pago + trial activo → "Tu período de prueba terminará el [fecha]"
  - CASO 2: Con método de pago + trial activo → Sin mensaje de advertencia (limpio)
  - CASO 3: Sin método de pago + eliminó durante trial → Mismo mensaje "período de prueba terminará"  
  - CASO 4: Sin método de pago + suscripción activa → "Tu suscripción no se renovará el [fecha]"
  - Sistema condicional que detecta automáticamente el estado exacto del usuario
  - Mensajes contextuales precisos que guían al usuario según su situación específica
  - Terminología clara diferenciando "período de prueba" vs "suscripción activa"
- June 28, 2025. MENSAJES DE TRIAL CORREGIDOS COMPLETAMENTE: Terminología clara indicando período de prueba
  - TrialManager (dashboard): Solo aparece sin método de pago, dice "Período de Prueba [Plan]" con mensajes claros
  - TrialManagerSimple (configuración): Siempre muestra estado, diferencia sin/con método de pago
  - Sin pago: "Período de prueba hasta el [fecha] • €X/mes después"
  - Con pago: "Período de prueba activo. Se cobrará el [fecha] • €X/mes"
  - Títulos corregidos de "Plan Pro" a "Período de Prueba Pro" para máxima claridad
  - Sección métodos de pago: "Tu período de prueba terminará" en lugar de "Tu suscripción terminará"
  - Todos los mensajes ahora indican explícitamente que están en período de prueba
- June 28, 2025. SISTEMA DE LOGIN TESTING COMPLETAMENTE IMPLEMENTADO: Tests exhaustivos para autenticación múltiple
  - 27 tests de login implementados y TODOS PASANDO exitosamente (27/27) en loginSystem.test.ts
  - Tests de autenticación múltiple: DNI, NIE, correo personal y correo corporativo funcionando
  - Encriptación segura validada: bcrypt con 10+ rounds, verificación y hashes únicos
  - Funcionalidad "Recordarme" completamente testeada: guardado, carga, eliminación y manejo de errores
  - Tests de normalización: emails a minúsculas, DNI/NIE a mayúsculas, eliminación de espacios
  - Seguridad verificada: rate limiting, no exposición de contraseñas, validación por empresa
  - Gestión de tokens JWT: generación correcta y persistencia en localStorage
  - Sistema robusto que garantiza funcionamiento correcto de todas las formas de login
  - Tests protegidos con comentarios ⚠️ PROTECTED para prevenir regresiones futuras
- June 28, 2025. SISTEMA DE TESTING VITEST IMPLEMENTADO COMPLETAMENTE: Protección crítica de funciones clave
  - Vitest configurado e instalado como framework de testing para Oficaz
  - Tests completos para calculateDays(): 14 casos que cubren fechas básicas, fines de semana, cambios de mes, años bisiestos
  - Tests exhaustivos para analyzeFileName(): 23 casos cubriendo detección de empleados, tipos de documento, niveles de confianza
  - Utilidades compartidas creadas: dateUtils.ts y documentUtils.ts con funciones protegidas usando comentarios ⚠️ PROTECTED
  - Configuración completa con vitest.config.ts, tests/setup.ts, mocks de localStorage y fetch
  - Todos los tests pasan exitosamente (64/64): sistema robusto que previene regresiones futuras
  - Funciones críticas blindadas contra cambios futuros que puedan romper funcionalidades clave
  - Sistema preparado para añadir tests de más funciones críticas (generatePDF, calculateTotal, formatTime)
- June 28, 2025. REORGANIZACIÓN DE PESTAÑAS VACACIONES COMPLETADA: Timeline ahora es pestaña principal
  - "Timeline de Vacaciones" reubicado como primera pestaña con nombre más descriptivo
  - Pestaña por defecto cambiada de "Solicitudes" a "Timeline de Vacaciones" 
  - Texto móvil actualizado: "Timeline" para pantallas pequeñas
  - Orden final: Timeline de Vacaciones → Solicitudes → Días Festivos
  - Sistema Gantt con barras correctamente posicionadas ahora es la vista principal
- June 28, 2025. BUG CRÍTICO BARRAS VACACIONES POSICIONAMIENTO RESUELTO: Timeline Gantt completamente funcional
  - PROBLEMA CRÍTICO: Barras de vacaciones aparecían fuera de líneas horizontales en timeline
  - SOLUCIÓN: Contenedor específico con absolute inset-0 overflow-hidden para barras
  - Altura barras reducida (h-10) vs contenedor (h-12) para margen interno adecuado  
  - Posicionamiento centrado: top:4px y bottom:4px para alineación perfecta
  - Eliminado overflow-hidden problemático del contenedor principal
  - Sistema Gantt ahora muestra barras perfectamente contenidas dentro de sus líneas
  - Funcionalidad completa: tooltips, cálculo dinámico días, botones revertir operativos
- June 28, 2025. BUG CRÍTICO PDF CORREGIDO: Cálculos de horas y formato de descansos completamente arreglados
  - PROBLEMA 1 RESUELTO: Cálculo de horas totales ahora descuenta correctamente los períodos de descanso
  - PROBLEMA 2 RESUELTO: Múltiples descansos ahora aparecen con saltos de línea (\n\n) en lugar de comas
  - PROBLEMA 3 RESUELTO: Formato mejorado con separador de barras verticales para evitar solapamiento
  - Actualizada función formatBreakPeriodsForPDF para usar ' | ' como separador sin interferir con layout PDF
  - Corregida lógica de cálculo: sessionHours - breakHours = horas reales trabajadas
  - Sistema ahora calcula: tiempo total (entrada-salida) menos tiempo total de descansos
  - PDFs muestran horas exactas trabajadas y descansos legibles con formato vertical espaciado
- June 28, 2025. BOTONES DE FICHAJE ADMIN ESTANDARIZADOS: Tamaños uniformes y debugging añadido
  - Todos los botones (Entrar, Salir, Descanso, Fin Descanso) estandarizados a w-[120px] h-[48px]
  - Logs de debugging añadidos a mutations de clock-in y clock-out para identificar errores específicos
  - Errores de Stripe en logs del servidor identificados como NO relacionados con sistema de fichaje
  - Sistema de fichaje admin mantiene funcionalidad idéntica a empleado con mensajes dinámicos
- June 28, 2025. DATOS DE EMPRESA A STRIPE CORREGIDOS: Información completa y fechas de cobro sincronizadas
  - Endpoint `/api/account/confirm-payment-method` corregido para enviar datos COMPLETOS de empresa a Stripe
  - Customer de Stripe ahora incluye: nombre empresa, dirección completa, CIF, email, datos contacto
  - Fechas de cobro en Stripe perfectamente sincronizadas con "Próximo cobro" mostrado en app
  - Trial periods respetan fecha exacta: `trial_end` en Stripe = `trial_end_date` de base datos
  - Pagos tardíos procesan inmediatamente pero mantienen alignment con próximas fechas
  - Facturación garantizada: Stripe tiene toda información necesaria para facturas precisas
  - Sistema crítico para cumplimiento legal: CIF, direcciones, datos fiscales correctos
  - Eliminada tarjeta verde "Suscripción Activa" de TrialManagerSimple.tsx para interfaz más limpia
  - Agregado mensaje discreto de cancelación programada en dashboard admin para usuarios sin método de pago
  - Corregido formateo de fecha en mensaje de cancelación usando nextPaymentDate del endpoint
- June 28, 2025. LÓGICA DE FACTURAS OPTIMIZADA: Sección solo visible con método de pago configurado
  - Sin método de pago → sección de facturas completamente oculta
  - Con método de pago → sección visible con facturas reales de Stripe o mensaje "aún no hay facturas"
  - Eliminados badges de "Demostración" y referencias a datos sintéticos del frontend
  - Sistema completamente limpio: solo muestra datos auténticos cuando hay configuración real
- June 28, 2025. BUG CRÍTICO CORREGIDO: stripe_customer_id ahora se busca en tabla users correctamente
  - Corregida consulta SQL para buscar stripe_customer_id en tabla `users` en lugar de `subscriptions`
  - Sistema de facturas ahora funciona correctamente con la estructura real de base de datos
  - Endpoint /api/account/invoices corregido para obtener customer ID del usuario admin de la empresa
  - Eliminados logs de debugging para versión de producción limpia
- June 28, 2025. HISTORIAL DE FACTURAS MIGRADO A STRIPE API: Sistema completamente integrado con datos reales
  - Reemplazado sistema de facturas sintéticas por integración directa con Stripe invoices API
  - Endpoint `/api/account/invoices` ahora consulta facturas reales de Stripe usando customer ID
  - Conversión automática de centavos a euros y formateo de fechas desde timestamps Unix
  - Botón de descarga PDF agregado cuando Stripe proporciona invoice_pdf URL
  - Sistema robusto: retorna array vacío en lugar de error cuando no hay Stripe customer ID
  - Solo muestra facturas pagadas (status: 'paid') para mejor experiencia de usuario
  - Datos completamente auténticos: números de factura, importes, fechas y descripciones reales
  - Eliminados todos los datos sintéticos hardcodeados del sistema de facturación
- June 28, 2025. MENSAJES DE AUTO-CANCELACIÓN OPTIMIZADOS: Terminología precisa implementada
  - Mejorados mensajes de advertencia para mostrar fecha exacta de cancelación de forma prominente
  - Mensaje principal corregido: "⚠️ Tu suscripción terminará el [fecha]" en lugar de "próximo pago"
  - Terminología precisa sin tarjeta: "terminará" y "se cancelará" en lugar de referencias a pagos
  - Ambas secciones actualizadas: tarjeta de estado de suscripción y sección de métodos de pago
  - Texto más directo y accionable: "Añade una tarjeta antes de esa fecha para mantener tu suscripción"
  - Sistema completo: detección automática → programación cancelación → warning claro con fecha específica
  - Formateo de fecha en español: "3 de agosto de 2025" usando formatDate con locale es-ES
  - Key único agregado para forzar re-render del componente en actualizaciones
  - Lógica condicional mejorada: "Próximo cobro" solo aparece con métodos de pago activos
  - Posicionamiento optimizado: mensaje de cancelación aparece exactamente donde aparecería "Próximo cobro"
- June 28, 2025. LÓGICA DE PAGOS OPTIMIZADA Y FINALIZADA: Sistema completo de fechas de primer y próximo pago
  - Campo firstPaymentDate añadido al esquema de suscripciones para manejar fecha del primer cobro
  - Lógica empresarial correcta implementada: pago antes del trial → primer cobro al terminar trial
  - Pago después del trial → primer cobro inmediato al añadir método de pago
  - Mensajes personalizados según escenario: "primer cobro el [fecha]" o "primer cobro procesado hoy"
  - Base de datos migrada exitosamente con nuevo campo first_payment_date
  - Endpoint confirm-payment-method actualizado para calcular ambas fechas independientemente
  - Sistema robusto que maneja correctamente los dos escenarios de timing de pago
- June 28, 2025. CONCEPTOS DE FECHAS CLARIFICADOS: Trial end vs Next payment date separados
  - Documentada diferencia crítica entre trial_end_date (bloqueo) y next_payment_date (cobro)
  - Sistema preparado para manejar pagos tardíos donde las fechas no coinciden
  - Lógica actual calcula correctamente próximo cobro basado en fin de trial + tiempo transcurrido
- June 28, 2025. TARJETA DE TRIAL OCULTA AL ACTIVAR SUSCRIPCIÓN: UX mejorada tras confirmación de pago
  - TrialManager.tsx modificado para retornar null cuando status='active' y trial inactivo
  - Eliminada tarjeta verde "Suscripción Activa" que aparecía tras confirmar pago
  - Interfaz más limpia: solo muestra notificaciones cuando hay acciones pendientes (trial o cuenta bloqueada)
  - Sistema de invalidación de cache implementado para refrescar estado tras pago exitoso
  - Etiquetas de estado traducidas al español: ACTIVO, PRUEBA, CANCELADO
- June 28, 2025. FLUJO DE PAGO TRIAL SIMPLIFICADO: Sistema optimizado para gestión de métodos de pago
  - TrialManagerSimple.tsx creado para enfoque específico en añadir métodos de pago durante trial
  - Componente simplificado sin funcionalidades de pago directo, solo gestión de tarjetas
  - Eliminadas secciones de trial expirado y cuenta bloqueada del componente original
  - Modal Dialog integrado con PaymentMethodManager para flujo de gestión de pagos
  - settings.tsx actualizada para usar TrialManagerSimple en lugar de TrialManager
  - Base de datos actualizada a status='trial' para permitir testing del flujo de trial
  - Sistema enfocado en añadir método de pago sin procesar pago inmediato
- June 27, 2025. AVISO DE TRIAL REDISEÑADO: Notificación discreta y menos invasiva implementada
  - Eliminada tarjeta grande y colores llamativos por diseño compacto horizontal
  - Fondos suaves con transparencias (amber-50/50, blue-50/30) en lugar de colores sólidos
  - Tipografía reducida: text-xs y text-sm para información esencial únicamente
  - Botón minimalista "Añadir pago" tipo ghost en lugar de botones grandes prominentes
  - Mensaje enfocado: "añadir método de pago" sin selección de plan (ya está elegido)
  - Iconos pequeños en círculos sutiles, información contextual según días restantes
  - Diseño discreto que no interrumpe el flujo de trabajo del usuario
- June 27, 2025. FECHAS DE TRIAL SINCRONIZADAS CON REGISTRO REAL: Inconsistencia crítica corregida
  - PROBLEMA RESUELTO: Trial iniciaba 3 días antes del registro de empresa (16 jun vs 19 jun)
  - Base de datos corregida: trial_start_date ahora coincide con company.created_at (19 junio 2025)
  - Trial period recalculado: 19 junio → 3 julio 2025 (exactamente 14 días desde registro real)
  - Sistema completamente sincronizado: empresa registrada y trial iniciado el mismo día
  - PaymentMethodManager implementado: interfaz completa para gestión de tarjetas con Stripe
  - Preparado para integración real de Stripe pendiente de claves API del usuario
- June 27, 2025. TRIAL MANAGER ACTUALIZADO: Precios dinámicos desde configuración super admin implementados
  - Eliminados precios hardcodeados (€3/€5/€8) en selector de planes de TrialManager
  - Añadido endpoint público /api/subscription-plans para usuarios autenticados
  - Query hook actualizada para usar datos reales de base de datos subscription_plans
  - SelectItems ahora muestran displayName y pricePerUser dinámicos (ej: "Plan Basic - €29.99/mes")
  - Función getPlanPrice() implementada para obtener precios específicos de cada plan
  - Sistema completamente integrado con configuración del super admin
- June 27, 2025. DATE PICKER COMPLETAMENTE REDISEÑADO: Sistema operativo eficiente implementado exitosamente
  - Componente DatePickerDay rediseñado con selección independiente año/mes/día para máxima eficiencia operativa
  - Eliminada navegación "pegajosa" mes a mes: ahora permite salto directo a cualquier fecha (ej: 5 años atrás)
  - Selectores independientes: Año (80 años hacia atrás), Mes (nombres en español), Día (adapta automáticamente)
  - Lógica inteligente: ajuste automático día al cambiar mes (ej: 31 Feb → 28/29 Feb)
  - Backend corregido: conversión Date→ISO string en funciones handleCreateEmployee y handleSaveEmployee
  - Sistema robusto: conserva funcionalidad existente mientras mejora dramáticamente la experiencia operativa
  - Cumple requerimiento crítico del usuario: "por dios no rompas nada" - todas las funciones previas intactas
- June 27, 2025. SISTEMA DE LÍMITES DE USUARIOS COMPLETAMENTE IMPLEMENTADO
  - Tarjeta de usuarios en configuración ahora muestra formato "X/Y" (usuarios actuales/límite máximo)
  - Validación de límite de usuarios implementada en creación de empleados
  - Mensaje de error específico cuando se intenta exceder el límite configurado en el plan
  - Sistema respeta límites configurados por super admin (ej: 50 usuarios para plan Pro)
- June 27, 2025. MODELO DE PRECIOS CAMBIADO A PRECIO FIJO MENSUAL: Ya no es por usuario
  - Actualizada interfaz super admin: "€ fijo/mes" en lugar de "€/mes" 
  - Schema comentado: pricePerUser ahora es precio fijo mensual (ej: 29.99 euros/mes)
  - Eliminado concepto de precio por usuario: ahora es precio fijo independiente del número de usuarios
  - Sistema de facturación simplificado: planes con precio mensual fijo sin multiplicadores
- June 27, 2025. SISTEMA DE TRIAL COMPLETAMENTE CORREGIDO: Ahora respeta tabla de super admin
  - Eliminado sistema hardcodeado de funcionalidades por trial que ignoraba configuración de super admin
  - Trial Basic y Pro ahora usan EXACTAMENTE las funcionalidades configuradas en tabla de super admin
  - Sistema unificado: checkFeatureAccess() consulta subscription.features[feature] para trial y activo
  - Trial ahora es SOLO limitación temporal (14 días), funcionalidades vienen de base de datos
  - Botón configuración funcional para ambos planes según configuración de super admin
  - Plan "free" eliminado del sistema → ahora empresas muestran "Basic" por defecto
- June 27, 2025. Banner de cookies optimizado para usuarios autenticados
  - Banner de cookies ya no aparece para usuarios logueados
  - Solo se muestra a visitantes no autenticados según normativa RGPD
  - Mejora la experiencia de usuario eliminando interrupciones innecesarias
- June 27, 2025. Tarjeta de visita empresarial implementada en dashboard empleado
  - Modal profesional que aparece al hacer clic en logo/nombre de empresa
  - Información corporativa completa: nombre empresa, CIF, dirección postal completa
  - Diseño minimalista y moderno con bordes redondeados (rounded-3xl)
  - Efecto glassmorphism elegante con backdrop-blur y transparencias
  - Iconos más pequeños y sutiles con contenedores rounded-xl
  - Tipografía refinada y espaciado compacto para look profesional
  - Responsive y accesible, solo muestra campos con datos reales
- June 27, 2025. Chat empleado completamente funcional en desktop y móvil - PROBLEMA CRÍTICO RESUELTO
  - CORREGIDO: Chat empleado ahora visible en ambas versiones (desktop Y móvil)
  - Eliminada clase lg:hidden que ocultaba el chat empleado en pantallas grandes
  - Visibilidad del chat en versión móvil mejorada con fondo degradado #1A2332 a #0F1419
  - Auto-scroll optimizado con selector específico para contenedor móvil empleado
  - Búsqueda inteligente de contenedor scrollable dentro de vista móvil oscura
  - Múltiples intentos de scroll (100ms, 300ms, 600ms) para asegurar funcionamiento
  - Sistema PROTEGIDO con comentarios ⚠️ DO NOT MODIFY para prevenir regresiones futuras
  - Chat empleado ahora funciona perfectamente en todas las resoluciones de pantalla
- June 27, 2025. Optimización crítica de rendimiento completada - polling reducido significativamente
  - Employee Dashboard: intervals de polling aumentados de 3-15s a 10-120s en todas las queries  
  - Work sessions activas: 3s → 10s para balance entre tiempo real y rendimiento
  - Break periods: 3s → 15s solo cuando hay sesión activa, deshabilitado en background
  - Messages: 10s → 30s con cache de 25s y sin polling en background
  - Documents/notifications: 15s → 60s con cache de 45s para reducir carga servidor
  - Vacation requests: 10s → 120s con cache de 90s ya que cambian poco frecuentemente
  - Employee Time Tracking: work sessions/breaks de 3s → 15s, active session 3s → 10s
  - Background polling completamente deshabilitado en todas las queries para mayor eficiencia
  - Stale time incrementado en todas las queries para mejor caching y menos requests
  - Resultado: reducción masiva de carga servidor manteniendo experiencia usuario aceptable
- June 27, 2025. Corregido problema de redirección en recarga de página
  - Ruta raíz "/" ahora usa componente PublicRoute para verificar autenticación
  - Usuarios logueados son redirigidos automáticamente al dashboard correspondiente
  - Ya no aparece landing page cuando usuario está autenticado tras recargar
  - Comportamiento correcto: admin → dashboard admin, empleado → dashboard empleado
- June 27, 2025. Sistema de protección EXPANDIDO: Funciones críticas de time tracking completamente blindadas
  - Extendida protección a funciones de cálculo estadístico: calculateTotal(), getLastFourMonths()
  - Blindada función generatePDF() en admin time tracking para informes de control horario
  - Protegida función formatTime() que formatea hora española en empleado time tracking
  - Blindada función renderMobileTimeline() CRÍTICA para visualización timeline móvil
  - Sistema de protección sistemático aplicado con comentarios ⚠️ PROTECTED y DO NOT MODIFY
  - Prevención completa de regresiones en funcionalidades clave de fichajes y visualización
  - Todas las funciones críticas ahora resistentes a cambios futuros que puedan romper el sistema
- June 27, 2025. Sistema de clasificación de documentos BLINDADO contra regresiones
  - Función analyzeFileName protegida con comentarios ⚠️ PROTECTED y advertencias "DO NOT MODIFY"
  - Eliminados logs de debugging que causaban confusión en producción
  - Documentación de estándares de protección de código crítico en User Preferences
  - Sistema resistente a cambios futuros que puedan romper la clasificación automática
  - Patrón de protección implementado para funcionalidades críticas del sistema
- June 27, 2025. Headers empleado estandarizados completamente siguiendo patrón de fichajes
  - Documentos, recordatorios y mensajes empleado ahora usan header estándar idéntico
  - Logo inteligente: se muestra solo si tiene logo Y función logoUpload habilitada por super admin
  - Filtro brightness-0 invert aplicado a logos para visibilidad en fondos oscuros
  - Comentarios "Standard employee pattern" y "Page title" añadidos para consistencia
  - Headers ahora siguen exactamente el mismo formato que employee-time-tracking.tsx
  - Eliminados headers inconsistentes con diseños personalizados diferentes
- June 27, 2025. Gráficas animadas al cargar página implementadas en timeline empleado
  - Barras de gráficas suben desde 0 hasta altura final con animación growHeight
  - Duración 1.2s ease-out con delays escalonados de 150ms entre barras
  - Tarjetas aparecen con fadeInUp y opacity inicial 0 para entrada suave
  - Animación CSS growHeight usando variable --final-height para altura dinámica
  - Delays: tarjetas (index * 100ms), barras (index * 150ms + 300ms) para secuencia visual
- June 27, 2025. Tarjeta de vacaciones rediseñada con colores de gráficas de fichajes
  - Total: text-blue-400 (azul vibrante como barras principales de fichajes)
  - Aprobados: text-orange-400 (naranja como barras de descanso en timeline)
  - Disponibles: text-green-400 (verde como puntos de entrada en timeline)
  - Barra de progreso: bg-blue-500 sólido (mismo azul que barras de trabajo)
  - Leyenda "días disponibles": text-green-400/70 para consistencia visual
  - Fondo: bg-white/10 backdrop-blur-sm rounded-xl border-white/20 (idéntico a gráficas)
  - Esquema de colores y fondo ahora coincide perfectamente con las gráficas de horas
- June 27, 2025. URL empleado simplificada: /fichajes-empleado → /misfichajes
  - Cambio de URL más amigable y corta para empleados
  - URL anterior /fichajes-empleado cambiada a /misfichajes
  - Actualizado en routing App.tsx y redirección de seguridad 
  - Dashboard empleado actualizado con nueva ruta en menuItems
- June 27, 2025. SEGURIDAD CRÍTICA: Protección de rutas de fichajes por roles implementada
  - Ruta /fichajes ahora requiere rol admin/manager obligatoriamente
  - Empleados son redirigidos automáticamente a /misfichajes
  - Imposible saltarse seguridad cambiando URL manualmente
  - Verificación de roles aplicada en routing de App.tsx
  - Sistema de redirección automática usando Redirect de wouter
- June 27, 2025. Timeline de empleado optimizado con tarjetas compactas y alineación perfecta
  - Altura de tarjetas reducida: padding de p-3 a p-2 para diseño más compacto
  - Header ajustado: margen inferior de mb-4 a mb-3 en fecha y horas totales
  - Timeline más compacto: altura reducida de h-7 a h-6 en contenedor de barras
  - Alineación corregida: header con mx-2 para coincidir exactamente con límites de barra azul
  - Espaciado mejorado: mb-4 en timeline para evitar solapamiento con puntos entrada/salida
  - Cambios aplicados uniformemente en sesiones individuales y días múltiples
  - Diseño final más limpio con textos perfectamente alineados a límites de barra temporal
- June 27, 2025. Timeline de empleado finalizado con barras ancho completo y UI optimizada
  - Barras de timeline rediseñadas para ocupar todo el ancho del contenedor (no proporcional)
  - Puntos de entrada (verde) y salida (rojo) sólidos en extremos izquierdo y derecho de barras
  - Sesiones individuales y múltiples usan ancho completo sin cálculos proporcionales basados en horas
  - Barras de descanso posicionadas correctamente dentro de barras de ancho completo
  - Tarjetas completas clickeables para expandir/contraer, no solo las barras de timeline
  - Texto "Descansos:" solo visible cuando el contenedor está expandido para vista limpia
  - Componente de debug eliminado completamente para código de producción
  - Funcionalidad expandir/contraer operativa tanto para sesiones individuales como múltiples
  - Sistema visual mejorado con jerarquía clara entre elementos expandidos y contraídos
  - Eliminadas etiquetas "Entrada:" y "Salida:" - solo hora en color verde (entrada) y rojo (salida)
  - Formato simplificado aplicado tanto en sesiones individuales como jornadas partidas
  - OPTIMIZADO: Contenedores más compactos (p-3 mb-2 en lugar de p-4 mb-3)
  - OPTIMIZADO: Eliminado icono gráfico 📊 del total semanal para diseño más limpio
  - OPTIMIZADO: Navegación al futuro bloqueada - usuarios no pueden ir a meses posteriores
  - MEJORADO: Sesiones múltiples del mismo día ahora se muestran en línea horizontal
  - MEJORADO: Cada sesión ocupa su porción proporcional del ancho disponible
  - MEJORADO: Puntos entrada/salida y barras de descanso ajustados para layout horizontal
- June 27, 2025. Timeline de empleado completamente rediseñado con estilo admin y puntos de entrada/salida
  - Barras de timeline h-5 (principal) y h-4 (descansos) igual que vista admin para consistencia visual
  - Puntos de entrada verdes y salida rojos con borde blanco y sombras para mejor visibilidad
  - Posicionamiento preciso: entrada alineada con inicio de barra, salida ligeramente a la derecha
  - Barras expandidas para ocupar más ancho del contenedor (±2% expansión)
  - Distancia reducida entre timeline y etiquetas de horas para mejor compactación
  - Soporte completo para múltiples sesiones por día con bloques separados
  - Agrupación inteligente por día: sesión única usa renderizado individual, múltiples sesiones agrupadas
  - Sistema de tooltips funcional para períodos de descanso con hover
  - Mantiene diseño mobile-first con jerarquía visual mejorada
- June 27, 2025. Sistema híbrido de posicionamiento horizontal implementado completamente
  - Algoritmo que detecta colisiones entre puntos y los desplaza horizontalmente
  - Desplazamiento horizontal sutil: entradas 1% izquierda, salidas 1% derecha
  - Todos los puntos mantienen alineación vertical con la barra azul (top: 0px)
  - Sistema inteligente: zonas sin colisión mantienen alineación + horas visibles
  - Zonas con colisión usan puntos desplazados + tooltips únicamente
  - Puntos con bordes blancos y sombras para mejor visibilidad
  - Sistema funcional que evita solapamientos manteniendo línea horizontal consistente
- June 27, 2025. Algoritmo de detección de proximidad en timeline corregido definitivamente
  - Umbral ajustado de 3 a 0 para máxima sensibilidad a la proximidad de puntos
  - Ahora cuando los puntos de entrada/salida están cerca, se ocultan las horas automáticamente
  - Sistema funciona correctamente: muestra solo puntos con tooltips hover cuando hay proximidad
  - Logs de depuración eliminados tras confirmar funcionamiento correcto del algoritmo
  - Comportamiento: cualquier proximidad detectada activa modo compacto (dots + hover)
- June 27, 2025. Sistema de tooltips para descansos implementado completamente
  - Tooltips dinámicos para descansos activos y completados en línea de tiempo de fichajes
  - Descansos activos: "Descanso en progreso: X min" con posicionamiento inteligente
  - Descansos completados: "Descanso: HH:MM - HH:MM (X min)" con duración y horarios
  - Sistema de tooltip personalizable con tooltipContent state y eventos mouse optimizados
  - Eventos onMouseEnter/onMouseLeave para mostrar/ocultar tooltips con limpieza de estado
  - Posicionamiento automático centrado sobre barras con flecha indicadora inferior
  - Compatible tanto con barras grises (completados) como naranjas pulsantes (activos)
- June 27, 2025. Sistema de mensajes dinámicos integrado en cajón de fichaje y toasts eliminados
  - Toasts de fichaje completamente eliminados y reemplazados por mensajes integrados
  - Línea de estado con colores distintivos: "🟢 Trabajando..." (verde) o "🔴 Fuera del trabajo" (rojo)
  - Estado visual inmediato usando text-green-400 para activo y text-red-400 para inactivo
  - Mensajes dinámicos según hora: "Buenos días/tardes/noches, Entrada/Salida registrada"
  - Sistema temporal: mensaje visible 3 segundos en "Tu último fichaje", luego vuelve al estado normal
  - Indicador visual: "✓ Fichaje exitoso" con texto verde cuando hay mensaje temporal
  - Lógica de saludos: 6-14h Buenos días, 14-20h Buenas tardes, resto Buenas noches
  - Funciones generateDynamicMessage() y showTemporaryMessage() para gestión de mensajes
  - Experiencia más fluida sin popups molestos, feedback directo en interfaz existente
- June 27, 2025. Dashboard de empleado optimizado con botón de fichar más grande y colores corporativos
  - Botón de fichar incrementado a 32x32 (w-32 h-32) con texto text-xl para mejor visibilidad
  - Iconos del menú cambiados de blanco a color corporativo #007AFF para coherencia visual
  - Logo empresa aumentado a h-10, nombre text-base para mayor prominencia sin "cajón"
  - Loading spinner del botón fichar aumentado a w-12 h-12 para mejor visibilidad
  - Header compacto: avatar 8x8, nombre text-xs, botón salir reducido
  - Contenedor principal usa h-screen sin overflow-y-auto para ajuste perfecto
  - Información de fichaje compacta: rounded-lg p-2, texto text-xs y text-sm
  - Espaciado mínimo: mb-2 entre secciones, gap-2 en grid de menú
  - Layout usando flex flex-col con p-4 para aprovechar toda la ventana
  - Garantizado que todo el contenido sea visible sin hacer scroll en móviles
  - Diseño profesional con colores corporativos #007AFF completamente consistentes
- June 27, 2025. Dashboard de empleado completamente rediseñado con estética moderna y elegante
  - Iconos de funcionalidades ampliados y con efectos glassmorphism inspirados en el hero de landing
  - Botones de menú con gradientes, backdrop-blur, efectos hover scale y animaciones de pulso
  - Notificaciones mejoradas con gradientes y efectos bounce más llamativos
  - Header de usuario modernizado con avatar circular de iniciales y botón salir elegante
  - Logo/nombre de empresa en contenedor glassmorphism con sombras y bordes sutiles
  - Información de último fichaje en tarjeta moderna con backdrop-blur y bordes translúcidos
  - Botón principal de fichar rediseñado: gradiente tricolor, efectos de brillo animados, partículas flotantes
  - Anillo pulsante verde cuando hay sesión activa, transiciones suaves y escalado hover
  - Mensaje de vacaciones mejorado con gradiente emerald-teal-cyan y efectos de profundidad
  - Todos los elementos mantienen funcionalidad completa sin cambios en lógica o navegación
- June 27, 2025. Sistema de gestión de invitaciones para super admin implementado completamente
  - Nueva página super-admin-invitations.tsx con diseño moderno espectacular y glassmorphism
  - Gestión completa de configuración de registro: público vs solo por invitación
  - Sistema de creación y gestión de enlaces de invitación con expiración de 7 días
  - Integración en dashboard super admin con botón prominente "Invitaciones"
  - Estadísticas visuales: invitaciones activas, utilizadas, expiradas y total
  - Funcionalidades: crear, copiar enlace, eliminar invitaciones con confirmación
  - Modal avanzado para crear invitaciones con email, invitador y empresa opcional
  - Sistema de badges de estado (activa/utilizada/expirada) con colores diferenciados
  - Interfaz responsive con efectos hover, transiciones suaves y tema oscuro
  - Routing completo configurado en App.tsx para /super-admin/invitations
- June 27, 2025. Logos de Oficaz corregidos en todas las páginas legales
  - Reemplazados logos improvisados (icono cookie, letra "O") por logo real de Oficaz
  - Política de Cookies, Privacidad y Términos ahora muestran imagotipo oficial
  - Logo con altura h-10 y ancho automático para proporciones correctas
  - Importación consistente desde '@assets/Imagotipo Oficaz_1750321812493.png'
- June 27, 2025. Navegación del header optimizada con anclas en español
  - Anclas cambiadas a español: #funciones y #precios en lugar de #features y #pricing
  - Eliminada ancla #testimonials del header ya que la sección fue removida
  - IDs de secciones actualizados para coincidir con anclas españolas
  - Fondo header completamente blanco sólido para máxima visibilidad sobre secciones oscuras
  - Shadow-xl y border más fuerte para contraste sobre hero negro
  - Navegación más limpia con solo dos enlaces principales: Funciones y Precios
- June 27, 2025. Hero section responsive corregido para pantallas PC estrechas
  - Cambiada altura fija por minHeight responsive con padding adaptativo
  - Textos y espaciado optimizados: tamaños escalables, espaciado reducido en móvil
  - Contenedor reducido a max-w-4xl para mejor lectura en pantallas estrechas
  - Indicadores de confianza adaptados: layout vertical en móvil, horizontal en desktop
  - Descripción actualizada: enfoque en horas perdidas en tareas específicas (envío archivos, control horarios manual)
  - Nueva frase final: "automatiza lo tedioso para que te enfoques en lo importante"
- June 26, 2025. Landing page final optimizada con CTA espectacular y estructura limpia
  - Eliminada sección completa de testimonios por preferencia del usuario
  - Sección CTA final ampliada y mejorada: gradiente triple azul, efectos blur, elementos flotantes
  - Título impactante "Transforma tu empresa en minutos" con gradiente cian-blanco-azul
  - Grid de beneficios: Configuración Instantánea, Equipo Productivo, Crecimiento Real
  - Descripción emocional enfocada en problemas reales: papeles perdidos, horas extras, procesos complicados
  - Botón CTA único "Empezar Gratis Ahora" con efectos hover y sin botón ventas
  - Indicadores de confianza: datos seguros, 15 días gratis, sin tarjeta requerida
  - Diseño moderno con badges, animaciones pulse y efectos hover avanzados
- June 26, 2025. Banner de cookies legal y completo implementado para cumplimiento RGPD
  - CookieBanner.tsx: componente completo con configuración personalizable de 4 tipos de cookies
  - Categorías legales: necesarias (obligatorias), funcionales, análisis y marketing con descripciones detalladas
  - Modal de configuración avanzada con switches individuales y explicaciones legales
  - Página /cookies completa con normativa RGPD, LOPD, LSSI y directiva ePrivacy
  - Gestión de consentimiento: localStorage para persistir preferencias del usuario
  - Botones: "Configurar", "Solo Necesarias", "Aceptar Todas" para máximo control
  - Enlaces legales integrados en footer de landing y banner para fácil acceso
  - Textos 100% conformes a normativa española y europea de protección de datos
- June 26, 2025. Landing page completamente optimizada con vistas previas funcionales y precios espectaculares
  - Sección de vistas previas: 4 tarjetas principales recreando funcionalidades sin capturas
  - Panel de empleados: estados variados (Juan descanso, Marta trabajando, Carmen trabajando, Ana vacaciones)
  - Control de fichajes: datos realistas con botón "Descanso", terminología amigable
  - Gestión de vacaciones: barras de progreso por empleado con días disponibles y colores diferenciados
  - Documentos inteligentes: área drag & drop con estado de distribución automática en tiempo real
  - Sección de precios rediseñada: fondo oscuro espectacular, glassmorphism, efectos hover avanzados
  - Eliminado "API personalizada", cambiado a 15 días de prueba, quitados elementos promocionales
  - Tarjetas de precios con altura uniforme usando flexbox y posicionamiento automático de botones
- June 26, 2025. Sección de funcionalidades rediseñada como viewport completo con estética app moderna
  - Altura completa de pantalla: min-h-screen con flex items-center para centrado vertical perfecto
  - Fondo sofisticado: gradiente from-gray-50 via-white to-blue-50/30 con elementos blur sutiles
  - Título espectacular: text-7xl font-black tracking-tight con gradiente "plataforma" en segunda línea
  - Tarjetas app-style: rounded-3xl, iconos grandes (w-20 h-20) con gradientes #007AFF, sombras dinámicas
  - Efectos hover avanzados: scale-105, -translate-y-2, glow effects, color transitions, shadow-2xl
  - Animaciones escalonadas: fadeInUp con delays de 150ms por tarjeta para entrada secuencial
  - Badge funcionalidades con punto pulsante y texto "Funcionalidades Principales"
  - CTA inferior con indicadores de confianza: "500+ empresas" y "implementación 24h"
  - Estética móvil moderna: iconos grandes, sombras suaves, backdrop-blur, bordes sutiles
- June 26, 2025. Hero section optimizado con iconos adaptativos y lenguaje accesible
  - Opacidad reducida a 3% para perfecta lectura del texto principal
  - Gradiente radial perfeccionado: centro 75% opaco, degradado hacia bordes (30% medio, 10% exterior)
  - Grid mobile optimizado: 3 columnas en móvil, gap-6 y padding-6 para iPhone sin solapamiento
  - Desktop mejorado: iconos w-32 h-32 más grandes, gap-8 reducido para menos separación
  - Mobile: iconos w-20 h-20 con separación óptima para no solaparse en iPhone
  - 32 iconos totales con animaciones pulse escalonadas para efecto dinámico
  - Centrado perfecto en pantallas grandes con contenedor responsive
  - Texto principal completamente legible con fondo oscurecido en el centro
  - Eliminado botón "Ver en Acción" por preferencia del usuario - solo "Empezar Gratis"
  - Frase descriptiva reubicada a sección de características para mejor contexto
  - Indicadores de confianza simplificados: lenguaje accesible ("Siempre disponible", "Datos protegidos", "Cumple normativas")
- June 26, 2025. Hero section mejorado con diseño premium y efectos visuales avanzados
  - Tipografía mejorada: text-8xl con font-black y tracking-tight para mayor impacto
  - Título dividido en 3 líneas con gradientes diferentes por línea para efecto visual dinámico
  - Badge premium con partículas animadas y efectos backdrop-blur-xl
  - Botones CTA mejorados: efectos shimmer, hover:scale-105, gradientes triples
  - Efectos de fondo avanzados: gradient mesh, floating particles, grid overlay sutil
  - Trust indicators con puntos de colores y espaciado responsive
  - Conservado texto exacto "para empresas que lo quieren fácil" según especificación
- June 26, 2025. Sección de screenshots rediseñada con layout espectacular y mobile responsive
  - Layout completamente nuevo con diseño mobile-first adaptativo
  - Tarjeta principal destacada con grid de dos columnas y contenido detallado
  - Efectos visuales modernos: hover, zoom, gradientes y sombras de colores
  - Fondo con patrón sutil y gradiente multi-color (slate-50 via white to blue-50)
  - Badges con categorías "TIEMPO REAL", "Gestión", "Seguridad" para cada screenshot
  - Transiciones suaves en hover: escala, rotación y efectos de zoom en imágenes
  - Botón CTA con gradiente y sombras implementado al final de la sección
- June 26, 2025. Hero section profesional y moderno implementado con efectos avanzados
  - Diseño oscuro sofisticado con gradientes slate-900 y efectos blur de colores
  - Título corregido "Para empresas que lo quieren fácil" según especificación del usuario
  - Hero fullscreen: ocupa toda la ventana menos header (calc(100vh-4rem)) sin scroll necesario
  - Elementos visuales flotantes: tarjetas glassmorphism con backdrop-blur y bordes translúcidos
  - Animaciones hover, pulse, ping y bounce para interactividad moderna
  - Indicadores de confianza profesionales: implementación 24h, seguridad bancaria, 99.9% uptime
  - Botones CTA con gradientes y sombras avanzadas, tipografía bold y profesional
  - Efectos de fondo: círculos blur, grid pattern y elementos animados distribuidos
- June 26, 2025. Landing page moderna y páginas legales profesionales implementadas completamente
  - Landing page efectiva con slogan "Para empresas que innovan" como mensaje principal modernizado
  - Hero section rediseñado con estilo profesional oscuro y elementos visuales sofisticados
  - Secciones completas: características, capturas, precios, testimonios, footer con enlaces
  - Política de Privacidad profesional: cumple RGPD, LOPD, incluye DPO, contactos AEPD
  - Términos de Servicio legales: planes SaaS, facturación, limitaciones, terminación, jurisdicción española
  - Navegación actualizada: "/" para landing, "/privacy", "/terms", "/login", "/request-code"
  - Diseño cohesivo con colores Oficaz (#007AFF), iconos Lucide, componentes shadcn/ui
  - Responsive completo con grid layouts adaptativos y tipografía escalable
- June 26, 2025. Componente StatsCard optimizado con diseño vertical compacto y iconos unificados
  - Layout vertical unificado: icono + número arriba, título y subtítulo abajo para evitar desbordamiento de texto
  - Tamaño reducido: altura h-20, padding p-3, iconos más pequeños para diseño más compacto
  - Margen inferior mb-4 agregado para separación visual entre filas de tarjetas
  - Responsive mejorado: tamaños de texto e iconos adaptativos para móvil y desktop
  - Iconos añadidos a todas las páginas: vacaciones (Clock, Check, Plane, CalendarDays) y documentos (FileText, Upload, Send, Users)
  - Consistencia visual total: todas las tarjetas StatsCard ahora tienen iconos en los círculos como en fichajes
  - Componente flexible que acepta valores string y number para máxima compatibilidad
- June 26, 2025. PDF de control horario completamente modernizado con diseño elegante y profesional
  - Agregado campo provincia en información de empresa para PDFs completos
  - Diseño moderno implementado: colores profesionales (azul oscuro #1F3347, grises elegantes)
  - Nombre de archivo actualizado con formato amigable: "Empleado - Filtro tiempo - DD-MM-YY - HH-MM.pdf"
  - Título del PDF mantiene formato profesional: "INFORME DE CONTROL HORARIO"
  - Headers de empresa rediseñados con línea divisoria sutil y jerarquía visual clara
  - Información de empleado y período reorganizada con etiquetas claras (EMPLEADO, PERÍODO)
  - Eliminada línea "Generado..." duplicada bajo período para diseño más limpio
  - Headers de tabla limpios: solo texto en negrita sin fondos ni bordes para máxima elegancia
  - Footer minimalista rediseñado sin fondo, solo línea superior y branding Oficaz
  - Numeración de páginas profesional cuando hay múltiples páginas
  - Mantiene funcionalidad completa: paginación mensual, datos reales de empresa, saltos inteligentes
  - Diseño coherente y profesional apto para presentaciones corporativas
  - Corregido cálculo "Media Horas Diarias": ahora calcula correctamente horas promedio por trabajador por día
  - Añadidas tarjetas "Media Horas Semanales" y "Media Horas Mensuales" con cálculos precisos por empleado y período
- June 25, 2025. Sistema de seguridad profesional SaaS implementado y login optimizado
  - Seguridad backend: Helmet CSP, CORS configurado, rate limiting global y específico por endpoint
  - Rate limiting login: máx 20 intentos por IP en 15min + bloqueo personalizado 5 intentos por usuario
  - Headers seguridad: CSP, X-Frame-Options, X-XSS-Protection, HSTS, Referrer-Policy completos
  - Login limpio y profesional: UI moderna, mensajes error claros, validación mejorada
  - Normalización de inputs: emails lowercase, DNIs/NIE uppercase automático
  - Logging de seguridad: auditoría de logins exitosos con IP y timestamp
  - Verificación cuenta activa: bloqueo automático de cuentas desactivadas
  - UI responsive: gradiente profesional, cards limpias, logos empresa dinámicos
- June 25, 2025. Problema crítico de autenticación DNI vs email completamente resuelto
  - Corregida persistencia de tokens: localStorage + setAuthData + verificación inmediata
  - Login por DNI (12345678Z) y email (admin@test.com) ahora funcionalmente idénticos
  - Headers de autorización correctamente aplicados en todas las peticiones API
  - Filtros protegidos contra datos null en time-tracking, admin-documents y employees-simple
  - Sistema de debugging mejorado para rastrear problemas de autenticación
  - Token persistence reforzado con múltiples métodos de guardado
  - Todas las funcionalidades accesibles independientemente del método de login usado
- June 25, 2025. Optimización móvil del wizard de registro y prevención de recargas
  - Wizard optimizado para móvil: logo centrado y más pequeño, títulos adaptados
  - Prevención de recargas accidentales en verificación de código móvil
  - Event listeners para visibilitychange, beforeunload y pageshow
  - Input optimizado para códigos OTP con inputMode="numeric" y autoComplete="one-time-code"
  - Mensaje informativo para usuarios móviles sobre copiar código antes de cambiar de app
  - Eliminados todos los toasts del flujo de verificación para evitar errores de JavaScript
- June 25, 2025. Logo PNG integrado correctamente en emails de verificación
  - Sistema base64 para embeber logo directamente en HTML del email
  - Tamaño optimizado para móvil: 35px altura, max 150px ancho
  - Compatible con todos los clientes de email sin attachments
  - Logo corporativo de Oficaz funcionando en template de verificación
- June 25, 2025. Sistema de verificación por email completamente funcional y seguro
  - Flujo de 3 pasos: request-code → verify-code → register  
  - Códigos de 6 dígitos con expiración de 10 minutos
  - Tokens de verificación temporales (30 minutos)
  - Nodemailer configurado con Hostinger SMTP (puerto 465, SSL)
  - Páginas request-code.tsx y verify-code.tsx funcionales
  - Protección completa: solo emails verificados pueden registrarse
  - Sistema de limpieza automática de códigos expirados
  - Frontend con fetch nativo para mayor confiabilidad
  - Navegación optimizada para evitar estados de carga bloqueantes
  - SEGURIDAD MEJORADA: URLs sin emails, sesiones cifradas, rate limiting, códigos hasheados
- June 25, 2025. Sistema de validación de unicidad implementado en wizard de registro
  - Validaciones en tiempo real para prevenir duplicados en empresa
  - Verificación de unicidad: nombre empresa, CIF, email facturación, alias empresa
  - Endpoint backend /api/validate-company para validaciones asíncronas
  - Indicadores visuales "Verificando disponibilidad..." durante validación
  - Botón submit deshabilitado mientras se validan campos
  - Validación onBlur para mejor experiencia de usuario con async validation
  - Preview dinámico de URL en campo alias que actualiza en tiempo real
- June 25, 2025. Wizard de registro de empresa implementado con proceso de 3 pasos
  - Paso 1: Preferencias de equipo (tamaño y funcionalidades de interés)
  - Paso 2: Datos de empresa (nombre, CIF, email facturación, alias, provincia)
  - Paso 3: Cuenta administrador (datos personales, contraseña, persona de contacto opcional)
  - Proceso intuitivo de 1 minuto con barra de progreso e indicadores visuales
  - Validación por pasos con navegación hacia atrás permitida
  - Opción de persona de contacto separada del administrador
  - Interfaz moderna con iconos y transiciones suaves
- June 25, 2025. Alias de empresa convertido a solo lectura en configuración
  - Campo alias ahora siempre en modo solo lectura para evitar problemas con URLs
  - Mensaje explicativo actualizado indicando que no se puede modificar
  - Decisión de seguridad para mantener consistencia de URLs de aplicación
- June 25, 2025. Error de CIF duplicado corregido en configuración de empresa
  - Agregada validación previa para verificar si CIF está cambiando
  - Solo valida duplicados cuando el CIF es diferente al actual
  - Mensaje de error específico para conflictos de CIF existentes
  - Backend ahora maneja correctamente actualizaciones sin cambio de CIF
- June 25, 2025. Header estándar aplicado a página de configuración corregido
  - Eliminado contenedor max-w-4xl mx-auto que no sigue el estándar
  - Aplicado patrón exacto de time-tracking: px-6 py-4 + overflowX: 'clip'
  - Header simple sin contenedores extra: h1 text-2xl + p text-gray-500 mt-1
  - Márgenes ahora consistentes con todas las páginas admin principales
- June 25, 2025. Armonía visual mejorada en TabNavigation slider
  - Cambiado rounded-xl a rounded-lg en contenedor exterior para mejor armonía con indicador slider
  - Ambos elementos ahora usan rounded-lg para apariencia visual más consistente
  - Componente TabNavigation ahora tiene curvas perfectamente alineadas
- June 25, 2025. Header estándar aplicado a página de recordatorios corregido definitivamente
  - Seguido patrón exacto de time-tracking.tsx: px-6 py-4 + overflowX: 'clip'
  - Header simple con mb-6: h1 text-2xl + p text-gray-500 mt-1
  - Eliminado contenedor bg-white border-bottom que no corresponde al estándar
  - Botón "Nuevo Recordatorio" posicionado correctamente fuera del header
  - Estructura final: igual a fichajes y otras páginas admin principales
- June 25, 2025. Banner de recordatorios adaptativo con ancho inteligente
  - Ancho adaptativo: minWidth 480px, maxWidth 70vw, width fit-content para adaptarse al contenido
  - Layout CSS Grid responsive: minmax(200px, 1fr) minmax(300px, 3fr) auto
  - Columna 1: Título del recordatorio + fecha/hora con icono de prioridad
  - Columna 2: Contenido con word-wrap y break-word para textos largos
  - Columna 3: Botones "Hecho" y "Cerrar" compactos
  - Espaciado aumentado: gap 24px para mejor distribución en banners anchos
  - Tipografía optimizada con line-height 1.6 y hyphens automático
  - Banner se expande automáticamente según longitud del texto del recordatorio
- June 25, 2025. Versión móvil de recordatorios para empleados implementada
  - Página employee-reminders.tsx creada siguiendo estética móvil de empleados (bg-employee-gradient)
  - Diseño consistente con navigation back button, header company info y título principal
  - Funcionalidad completa: crear, editar, eliminar, completar, archivar, fijar recordatorios
  - Sistema de filtros por estado (activos, completados, archivados) y búsqueda
  - Selección de colores y prioridades con iconos distintivos y preview en tiempo real
  - Botón Recordatorios agregado al dashboard empleado apuntando a ruta correcta
  - Routing configurado para mostrar versión empleado vs admin según rol de usuario
  - Sistema de tarjetas con acciones rápidas y estados visuales con badges informativos
- June 26, 2025. Filtros de fichajes integrados en tabla y tiempo real completamente funcional
  - Filtros movidos entre título y encabezados de tabla para mejor UX
  - Fondo gris claro (bg-gray-50) con border-bottom para separación visual clara
  - Tiempo real funcionando perfectamente: admin ve fichajes inmediatos sin recargar
  - Polling cada 5 segundos en admin time-tracking para actualizaciones automáticas
  - Sistema responsive: cambios aparecen inmediatamente cuando empleados fichan
- June 26, 2025. Sistema de actualizaciones en tiempo real para fichajes implementado
  - Admin time-tracking: refetchInterval 5s para ver fichajes de empleados en tiempo real
  - Employee dashboard: refetchInterval 3s para estado de sesión activa
  - Employee time-tracking: refetchInterval 3s para sesión activa, 5s para historial
  - staleTime reducido a 10-30 segundos para datos más frescos
  - refetchIntervalInBackground: true para actualizaciones continuas
- June 26, 2025. Elementos de menú con restricciones visuales implementados
  - Sidebar: elementos restringidos con text-gray-400, opacity-60, iconos opacity-50
  - Dashboard empleado: botones restringidos con bg-gray-300, opacity-50, iconos y texto grises
  - Funcionalidades aparecen "menos marcadas" para indicar restricción visual
  - Sistema visual consistente que indica restricciones sin ocultar completamente funcionalidades
- June 25, 2025. Sistema completo de recordatorios integrado en planes de suscripción
  - Funcionalidad "reminders" agregada a base de datos y configuración de planes
  - Plan Basic: recordatorios deshabilitados (reminders: false), Pro/Master: habilitados (reminders: true)
  - Botones aparecen en navegación pero muestran página de restricción al hacer clic
  - Super admin puede configurar "Recordatorios" en gestión de planes con icono Bell
- June 25, 2025. Sistema de recordatorios optimizado y errores de consola corregidos
  - ERRORES DE CONSOLA RESUELTOS: polling se detiene automáticamente cuando usuario no está autenticado
  - Sistema de autenticación mejorado: verificación de token antes de hacer polling de recordatorios
  - Polling optimizado: reducido a 3 segundos para balance entre tiempo real y rendimiento
  - Headers anti-cache mantenidos para actualizaciones inmediatas cuando usuario está logueado
  - Sistema funcional sin spam de errores: recordatorios aparecen automáticamente al llegar su hora
  - Funcionalidad completa: crear, editar, programar, descartar recordatorios con notificaciones silenciosas
- June 24, 2025. Sistema de configuración personalizada de empresas corregido y optimizado
  - Corregido problema de persistencia del estado useCustomSettings
  - Toggle button ahora guarda correctamente el estado al activar/desactivar
  - Mutación actualizada para sincronizar datos del servidor con estado local
  - Sistema completo funcional: empresas alternan entre configuración automática y personalizada
- June 24, 2025. Sistema de configuración personalizada de empresas implementado
  - Botón toggle para activar/desactivar opciones personalizadas por empresa
  - Por defecto, empresas siguen configuración automática del plan asignado
  - Con personalización activa, super admin puede modificar funcionalidades individualmente
  - Campo useCustomSettings en base de datos para controlar el comportamiento
  - Backend actualizado para aplicar configuración del plan cuando personalización está desactivada
  - UI intuitiva que muestra estado actual y permite cambio fácil entre modos
- June 24, 2025. Lógica inteligente de logos implementada y corregida
  - Corregidos todos los errores de variables no definidas en componentes
  - Implementada lógica: mostrar logo solo si existe Y función logoUpload habilitada en super admin
  - Test Company con plan Basic (logoUpload=false) muestra texto "Test Company" en lugar de logo
  - Todos los componentes actualizados: sidebar, mobile-header, employee-dashboard, time-tracking, vacation, documents
  - Sistema funcional: logos existentes solo se muestran si la función está habilitada por super admin
- June 24, 2025. Sistema de subida de logos con restricciones por plan implementado
  - Lógica inteligente: logos existentes se mantienen independientemente del plan
  - Subida/cambio de logos restringida a planes Pro y Master (no disponible en Basic)
  - Eliminación de logos disponible para todos los planes
  - Mensajes contextuales: restricción para usuarios sin logo, info para usuarios con logo existente
  - Nueva sub-funcionalidad "logoUpload" dentro de personalización en super admin
  - Base de datos actualizada con nueva funcionalidad en todos los planes
- June 24, 2025. Sistema completo de subida de logos implementado y corregido
  - Reemplazado input URL por sistema de upload de archivos
  - Subida directa de imágenes JPG, PNG, SVG con validación de 2MB máximo
  - Preview en tiempo real del logo seleccionado antes de guardar
  - Eliminación automática del logo anterior al subir uno nuevo
  - Botón eliminar para quitar logos existentes
  - Backend con endpoint dedicado para manejo seguro de archivos
  - Validación de tipos de archivo y tamaño con mensajes toast informativos
  - Corregido endpoint /api/auth/me para incluir logoUrl explícitamente
  - Sincronización inmediata del estado local tras subida exitosa
  - Actualizada lógica en todos los headers: mobile-header, sidebar, employee-dashboard
  - Logos se muestran en lugar de texto cuando están disponibles en toda la aplicación
  - Logos más grandes y visibles sin contenedores restrictivos
  - Filtro de inversión de color en vistas de empleado para logos oscuros en fondos oscuros
  - Guía educativa con recomendaciones de tipos de logo (logotipo vs imagotipo)
  - Ejemplo visual usando el imagotipo de Oficaz como referencia de buenas prácticas
- June 24, 2025. Campos adicionales de empresa agregados a configuración
  - Añadido logoUrl con preview visual del logo de la empresa
  - Añadido companyAlias para URLs personalizadas de la aplicación
  - Añadido contactName para persona responsable de la empresa
  - Interfaz reorganizada con sección de logo prominente
  - Todos los campos disponibles en base de datos ahora editables
- June 24, 2025. Sistema completo de recordatorios tipo Google Keep implementado
  - Tabla reminders en base de datos con campos: título, contenido, fecha/hora, prioridad, color, estados
  - Backend con endpoints CRUD completos y manejo correcto de fechas
  - Página de gestión visual con interfaz Google Keep style: tarjetas coloridas, filtros, búsqueda
  - Banner de notificaciones en tiempo real para recordatorios programados
  - Botón Recordatorios agregado al sidebar para admin y empleados
  - Funcionalidades: crear, editar, eliminar, completar, archivar, fijar recordatorios
  - Sistema de prioridades (alta, media, baja) con iconos y colores distintivos
  - Selección de colores personalizados para organización visual
  - Corregido error de actualización por manejo incorrecto de fechas en Drizzle ORM
  - Sistema de banner de notificaciones implementado y funcionando
  - Componente ReminderBanner integrado en App.tsx con polling cada 5 segundos
  - Endpoint /api/reminders/active configurado para mostrar recordatorios programados
- June 24, 2025. Sistema jerárquico de funcionalidades implementado con "timeEditingPermissions"
  - Nueva sub-funcionalidad "Editar horas empleados" dentro de Fichajes
  - Plan Basic: timeEditingPermissions=false, Plan Pro/Master: timeEditingPermissions=true
  - Base de datos actualizada con nueva funcionalidad en todos los planes y suscripciones
  - Página de configuración/políticas: Select deshabilitado si el plan no incluye la funcionalidad
  - Indicador visual con mensaje "No disponible en tu plan" y advertencia del plan requerido
  - Sistema jerárquico: funcionalidades principales y sub-funcionalidades organizadas
  - Verificación simplificada: empleados solo verifican configuración de empresa
  - Empresas con plan Basic forzadas a employeeTimeEditPermission='no' automáticamente
  - Base de datos sincroniza automáticamente configuración según plan activo
- June 24, 2025. Orden de funcionalidades actualizado en gestión de planes
  - Cambio en super-admin-plans.tsx: fichajes, vacaciones, documentos, mensajes
  - Orden consistente con prioridad de uso y flujo lógico de la aplicación
  - Todas las tablas de configuración ahora siguen el mismo orden estándar
- June 24, 2025. Sistema de páginas de funcionalidades restringidas implementado
  - Eliminado sistema de sidebar deshabilitado por navegación limpia
  - Usuarios pueden navegar a todas las páginas sin restricción en el menú
  - Páginas muestran mensaje "No disponible en tu plan" cuando funcionalidad está restringida
  - Componente FeatureRestrictedPage reutilizable para todas las funcionalidades
  - Hook useFeatureCheck para verificar acceso a funcionalidades
  - Sistema más user-friendly que permite explorar pero informa sobre limitaciones
  - Documentos ahora requieren plan Pro (no disponible en Basic)
  - Plan Basic: mensajes, vacaciones, fichajes | Plan Pro: + documentos, reportes
- June 24, 2025. Sistema de gestión individual de empresas implementado completamente
  - Nueva página de configuración personalizada por empresa individual
  - Super admin puede cambiar plan, límites de usuarios y precio personalizado por empresa
  - Funcionalidades pueden activarse/desactivarse independientemente del plan base
  - Empresa con plan Basic puede tener funcionalidades de Pro/Master si el super admin lo permite
  - Backend expandido con endpoints para gestión granular de empresas
  - Esquema de base de datos actualizado con precios personalizados por empresa
  - Navegación desde dashboard principal con botón "Gestión de Empresas"
- June 24, 2025. Sistema de restricciones por plan de suscripción implementado completamente
  - Todas las empresas migradas del plan "free" al plan "Basic"
  - Backend actualizado para propagar cambios de funcionalidades a empresas
  - Hook useAuth expandido para incluir información de suscripción
  - Sistema de restricciones de funcionalidades en sidebar implementado
  - Elementos del menú se deshabilitan según el plan activo de la empresa
  - Indicadores visuales para funcionalidades restringidas
  - Librería feature-restrictions.ts para gestión centralizada de permisos
- June 24, 2025. Sistema completo de gestión de cuenta finalizado con datos 100% auténticos
  - TODOS los datos hardcodeados eliminados definitivamente del sistema de cuenta
  - Fecha de registro usa fecha real de creación de empresa (19 junio 2025)
  - Email de facturación usa email real del administrador (admin@test.com)
  - Dirección fiscal basada en provincia real de la empresa (Sevilla - 41001)
  - CIF/NIF usa identificador real de la empresa desde base de datos
  - Sistema robusto sin fallbacks ni datos sintéticos nunca más
- June 24, 2025. Sistema completo de gestión de cuenta implementado con datos 100% reales
  - TODOS los valores hardcodeados eliminados permanentemente de la pestaña "Mi Cuenta"
  - Componente AccountManagement totalmente funcional usando solo datos auténticos de la base de datos
  - Estadísticas dinámicas: empleados activos reales, fichajes del mes actual, documentos subidos
  - Información de cuenta completamente auténtica sin fallbacks ni placeholders
  - Historial de facturas real con datos de pagos y estados correctos
  - Métodos de pago usando datos reales de la base de datos
  - Backend optimizado con endpoints que devuelven solo datos auténticos calculados en tiempo real
  - Sistema resistente a errores pero sin mostrar datos falsos nunca
- June 24, 2025. Página de gestión de cuenta "Mi Cuenta" implementada en configuración
  - Nueva pestaña con estado de suscripción Premium y estadísticas de uso
  - Información de registro, ID de cuenta y administrador principal
  - Sección de facturación con direcciones fiscales y método de pago
  - Historial de facturas descargables con estados de pago
  - Botones de gestión: cambiar plan, método pago, exportar datos
  - Zona de peligro para pausar o cancelar cuenta con advertencias
- June 24, 2025. Sistema de pestañas tipo slider moderno implementado globalmente
  - Componente TabNavigation convertido a diseño slider con fondo redondeado
  - Indicador deslizante blanco con transiciones suaves de 300ms
  - Textos responsive: completos en desktop, abreviaciones en móvil
  - Optimizado para móvil: padding reducido, texto más pequeño, iconos protegidos
  - Todas las abreviaciones en español: "Archivos", "Solicitudes", "Políticas"
  - Se aplica automáticamente en vacaciones, documentos y configuración
- June 24, 2025. Componente TabNavigation reutilizable implementado
  - Creado componente genérico para navegación por pestañas con iconos
  - Refactorizado admin-documents.tsx para usar nuevo componente
  - Implementado en vacation-management.tsx con 3 pestañas consistentes
  - Diseño uniforme: Solicitudes, Empleados de Vacaciones, Días Festivos
  - Sistema de navegación coherente en toda la aplicación admin
- June 24, 2025. Sistema de provincia de empresa implementado dinámicamente en vacaciones
  - Eliminado hardcodeo de "Madrid" en selector de días festivos
  - Provincia ahora se obtiene automáticamente de los datos de la empresa
  - Mapeo inteligente provincia → región para días festivos españoles
  - Selector inicia con región correcta basada en ubicación real de la empresa
  - Sistema dinámico usando useAuth() para obtener datos de compañía
- June 24, 2025. Sistema unificado de tarjetas StatsCard completamente implementado
  - Eliminadas tarjetas hardcodeadas de vacaciones para usar solo StatsCard
  - Layout mobile consistente: grid-cols-4 con gap-2 en todas las páginas
  - Layout desktop: grid-cols-2 md, grid-cols-4 lg con gap-6
  - Componente responsive único: icono + número horizontal en móvil, layout completo en desktop
  - Texto móvil truncado automático y padding compacto (p-4) para máxima consistencia
- June 24, 2025. Layout de filtros de time-tracking completamente blindado y optimizado
  - Botones distribuidos uniformemente: flex-1 para ocupar todo el ancho disponible
  - Tipografía consistente: text-xs font-normal text-center en todos los botones
  - Separación perfecta: gap-2 entre botones sin espacios vacíos
  - Grid responsive: lg:grid-cols-3 (empleado 1 col, filtros 2 cols) para distribución óptima
  - Componente DatePickerPeriod corregido: text-xs para consistencia tipográfica
  - Layout blindado con comentarios protectores para prevenir modificaciones futuras
  - ⚠️ IMPLEMENTACIÓN FINAL: NO MODIFICAR MÁS - funciona perfectamente
- June 23, 2025. Historial de solicitudes funcionando completamente con documentos recibidos
  - Sistema de pestañas "Solicitudes" totalmente operativo mostrando historial real
  - JOIN optimizado entre document_notifications, users y documents
  - Muestra empleado destinatario, tipo documento, estado (pendiente/completado) y fecha
  - Indica qué documento se subió en respuesta a cada solicitud con banner verde
  - Query SQL directa evitando problemas de Drizzle ORM con nested selects
  - Auto-refresh cada 3 segundos para actualizar estado de solicitudes en tiempo real
- June 23, 2025. Interface de documentos admin rediseñada con sistema de pestañas completo
  - Convertidas tarjetas en 3 pestañas modernas: Subir Documentos, Explorador, Solicitudes
  - Drag & drop mantenido en pestaña "Subir Documentos" con detección inteligente
  - Pestaña "Explorador" con búsqueda y filtros para ver archivos subidos
  - Pestaña "Solicitudes" COMPLETAMENTE FUNCIONAL: envío + historial de solicitudes enviadas
  - Backend expandido: getDocumentNotificationsByCompany para admin/manager
  - Navegación visual mejorada con indicadores de pestaña activa
  - Contador dinámico de "Subidos Hoy" en stats cards
  - Historial mostrando estado (pendiente/completada), empleado destinatario, fechas
- June 23, 2025. Sistema de fechas corregido para mostrar hora española correcta
  - Conversión UTC a GMT+2 (hora española) en visualización de documentos
  - Documentos ahora muestran hora local real de subida (+2h de diferencia)
  - Formato consistente en vistas admin y empleado con zona horaria corregida
- June 23, 2025. Sistema de renombrado automático de documentos por solicitud funcionando
  - Archivos se renombran según tipo solicitado: "DNI - Juan José Ramirez Martín.ext"
  - Implementación en backend evita errores "object is not constructor"
  - Sistema de actualización automática cada 3 segundos en vista admin
  - Invalidación inmediata tras subir, eliminar o enviar solicitudes
- June 23, 2025. Auto-scroll mejorado en chat para mostrar último mensaje al abrir conversación
  - Implementación simple restaurada: messagesEndRef.scrollIntoView con timeout 300ms
  - Usa messages.length como dependencia en lugar de messagesGroupedByDate.length
  - Comportamiento instant para apertura de chat al seleccionar conversación
  - Sistema protegido con comentarios para prevenir modificaciones futuras
  - ⚠️ NO MODIFICAR MÁS - implementación funcional final
- June 23, 2025. Sistema de documentos completamente optimizado y blindado para máxima robustez
  - Código reestructurado en componentes modulares: DocumentDropZone, DocumentsList, UploadPreviewDialog, DeleteConfirmDialog
  - Componentes protegidos con React.memo para optimización de rendimiento
  - Handler handleFilesSelected blindado con try-catch y logs de auditoría
  - Interfaces TypeScript estrictas para prevención de errores en tiempo de compilación
  - DisplayNames configurados para debugging avanzado en desarrollo
  - Callbacks optimizados con useCallback para prevenir re-renders innecesarios
  - Sistema de detección IRPF operativo con formato: "Otros Marzo 2025 (IRPF) - Nombre.pdf"
  - Comentarios protectores para prevenir modificaciones futuras accidentales
  - Estructura bulletproof resistente a cambios y errores de desarrollo
- June 23, 2025. Sistema de seguridad multicapa reforzado para documentos
  - Validación estricta: empleados solo acceden a sus propios documentos
  - Admin/manager: solo documentos de empleados de su misma empresa
  - Logging de auditoría: accesos, subidas y eliminaciones registradas
  - Protección cross-company: imposible acceder a datos de otras empresas
  - Validación de existencia de usuarios antes de operaciones
  - Vista previa corregida: blob URLs temporales sin descargas automáticas
- June 23, 2025. Sistema completo de gestión inteligente de documentos implementado
  - Drag & drop inteligente con detección automática de empleados por nombre
  - Detección de tipos de documento por palabras clave configurables
  - Corrección automática de nombres: mayúsculas, fechas completas con año, nombres completos
  - Sistema de eliminación completo: base de datos + archivos físicos del servidor
  - Modal de preview con análisis de confianza y corrección manual antes de subir
  - Formato estándar: "Tipo Documento Mes Año - Nombre Completo Empleado.ext"
  - Ejemplo: "nomina junio 2025 - juan jose.pdf" → "Nómina Junio 2025 - Juan José Ramírez Martín.pdf"
  - Seguridad por roles: admin/manager pueden eliminar documentos de su empresa
- June 23, 2025. Títulos de páginas empleado estandarizados con formato consistente
  - Todas las páginas empleado ahora usan text-3xl font-bold text-white mb-2
  - Subtítulos descriptivos con text-white/70 text-sm unificados
  - "Control de Tiempo", "Vacaciones", "Documentos", "Mensajes" con formato idéntico
  - Padding px-6 pb-6 consistente en todas las páginas empleado
  - Eliminado formato anterior de employee-time-tracking para consistencia total
- June 23, 2025. Header del chat empleado funcionando correctamente en iPhone
  - Corregida lógica para usar managers en lugar de filteredEmployees para empleados
  - Vista empleado usa (user?.role === 'employee' ? managers : employees) para encontrar contacto
  - Header del chat individual empleado ahora muestra nombre y avatar correctamente
  - Sistema blindado con comentarios protectores para evitar futuros cambios
  - Header empleado con tema oscuro y flecha blanca visible implementado
  - Auto-scroll restaurado en vistas admin desktop y móvil para ir al último mensaje
  - Vista empleado sin iconos de rol, solo texto de cargo para diseño limpio
  - ⚠️ PROTEGIDO: Auto-scroll funcional NO MODIFICAR - useEffect con timeout 100ms y scrollIntoView
  - Desktop: flexbox justify-content abajo + auto-scroll para posicionamiento robusto
  - ⚠️ CRÍTICO: NO MODIFICAR MÁS EL AUTO-SCROLL - Funciona parcialmente, dejar como está
- June 23, 2025. Auto-scroll restaurado usando implementación original funcional
  - COPIADO DIRECTO de implementación que funcionaba sin modificaciones
  - messagesEndRef con scrollIntoView behavior instant/smooth
  - useEffect separados para selectedChat (instant) y messages (smooth)
  - Timeout 100ms como en versión funcional original
  - ⚠️ NUNCA MÁS MODIFICAR - usar esta implementación exacta
- June 23, 2025. Sistema completamente dinámico de roles sin datos hardcodeados implementado
  - Función getRoleDisplay refactorizada para usar solo datos reales de base de datos
  - Eliminados todos los valores hardcodeados ("Empleado", "Administrador", "Manager")
  - Sistema de iconos dinámico basado en configuración por rol
  - Muestra jobTitle/position real o "Sin cargo definido" si no está configurado
  - Configuración centralizada para colores, letras y tamaños de iconos por rol
  - Prioriza datos reales sobre cualquier texto por defecto
- June 23, 2025. Sistema de doble check corregido según roles en mensajería
  - Admin/Manager: check simple (gris) mensaje entregado, doble check (verde) mensaje leído
  - Empleados: check simple verde (mensaje recibido por admin pero no necesariamente leído)
  - Lógica diferenciada por rol para indicadores de estado precisos
  - Solo visible para el emisor del mensaje en todas las vistas (desktop/móvil)
  - Sistema implementado correctamente según jerarquía empresa
- June 23, 2025. Sistema de mensajería para empleados completamente funcional implementado
  - Vista empleado restaurada: lista de responsables con contadores de mensajes no leídos
  - Chat móvil funcional: navegación por click directo en lugar de URL para mejor UX
  - Auto-scroll optimizado: solo funciona en vista desktop admin/manager, no interfiere con chat móvil
  - Swipe-to-chat mantenido: funciona desde tarjetas de empleados usando parámetros URL
  - Sistema híbrido: admin usa desktop, empleados usan móvil full-screen sin conflictos
  - Acceso rápido super admin corregido: emails actualizados (marta.perez@test.com, juanramirez2@gmail.com)
- June 21, 2025. Sistema completo de gestión de empleados y campo provincia implementado
  - Sistema de login actualizado: busca en company_email primero, luego en personal_email automáticamente
  - Empleados pueden hacer login con email personal si no tienen corporativo asignado
  - Modal creación empleados completo: todos los campos como edición, validación obligatorios (nombre, DNI)
  - Campo "Tipo de Usuario" añadido: admin puede cambiar rol empleado/manager/admin desde modal
  - Información personal editable: email, teléfono, dirección, contactos emergencia para admin
  - Campo provincia añadido a companies: selector con todas las provincias españolas para días festivos
  - Credenciales verificadas: juanramirez2@gmail.com / 123456, marta.perez@test.com / 123456
  - Base de datos actualizada con migración automática para campo province
- June 21, 2025. Sistema completo de detección automática de vacaciones implementado
  - Dashboard empleado: detecta vacaciones activas y muestra mensaje "¡Disfruta de tus vacaciones, te las has ganado!" con icono palmera
  - Vista admin mejorada: empleados de vacaciones se detectan automáticamente por solicitudes aprobadas activas
  - Cálculo dinámico de días: tarjetas muestran días aprobados calculados en tiempo real, no campos obsoletos de BD
  - Barra empleado simplificada: "Aprobados" (todas las aprobadas) vs "Disponibles" (total - aprobados), sin pendientes
  - Función calculateDays implementada correctamente usando differenceInDays + 1 para períodos inclusivos
- June 21, 2025. Sistema completo de gestión de vacaciones admin-empleado implementado y funcionando
  - Funcionalidad PATCH corregida: conversión correcta de fechas string a Date objects
  - Popover con comentarios admin: empleados ven comentarios en solicitudes procesadas
  - Testing completo: creadas 4 solicitudes pendientes para Juan José (Semana Santa, mayo, verano, navidades)
  - Estados de empleado actualizados: Juan José configurado como "de_vacaciones" para testing
  - Alineación UI perfeccionada: columnas de estado alineadas izquierda con headers coincidentes
  - Días de vacaciones sincronizados: usedVacationDays actualizado tras eliminar solicitudes históricas
- June 21, 2025. Página de fichajes admin optimizada y documentada completamente
  - Código reorganizado con secciones claras y comentarios descriptivos
  - Imports agrupados por categoría (hooks, componentes UI, iconos)
  - Funciones documentadas con propósito específico de cada una
  - Estados organizados por función (filtros, fechas, UI, edición)
  - Altura de filas normalizada: h-12 para fichajes, h-10 para resúmenes
  - Tabla compacta sin altura mínima fija para mejor UX
  - Componentes DatePicker finalizados con modal centrado y navegación inteligente
  - DatePickerPeriod: modal centrado en pantalla, no dropdown
  - Navegación automática: abre en fecha del período existente o mes actual
  - defaultMonth configurado para mostrar fechas relevantes al abrir
  - Interfaz limpia: botones "Limpiar fechas" y "Cerrar", sin textos redundantes
  - Tabla de fichajes estabilizada con altura mínima y mensaje sin datos
  - Componente reutilizable en toda la aplicación con comportamiento consistente
- June 21, 2025. Página de gestión de vacaciones para admin implementada con diseño consistente
  - Nueva vista separada para admin/manager en /vacaciones con gestión completa
  - 3 pestañas: Solicitudes, Empleados de Vacaciones, Días Festivos
  - Estadísticas visuales: pendientes, aprobadas, empleados de vacaciones, días festivos
  - Gestión de solicitudes: aprobar/denegar con botones de acción directa
  - Vista de empleados actualmente de vacaciones con tarjetas informativas
  - Calendario de días festivos de España 2025 con selector de región
  - Mismo diseño y colores que página de fichajes admin para consistencia
  - Empleados mantienen su vista actual de vacaciones sin cambios
- June 20, 2025. Sistema completo de super admin implementado para gestión multi-empresa
  - Nueva URL separada: /super-admin/login con autenticación independiente
  - Dashboard con estadísticas globales: empresas activas, usuarios totales, ingresos MRR
  - Planes de suscripción: Free (5 usuarios), Basic (€29), Pro (€59), Master (€149)
  - Vista de todas las empresas con filtros por plan, estado y búsqueda en tiempo real
  - Distribución visual de planes con contadores y colores diferenciados
  - Base de datos expandida: tablas super_admins y subscriptions con relaciones
  - Credenciales super admin: admin@oficaz.com / admin123
  - Sistema de tokens JWT separado para autenticación de super admin
  - Interfaz moderna con gradientes, glassmorphism y animaciones suaves
  - Gestión de planes en tiempo real: click en badge o botón editar para cambiar plan
  - API endpoints para actualizar suscripciones con validación de planes
  - Actualización automática de estadísticas e ingresos al cambiar planes
  - Página de acceso rápido temporal en /fast para testing sin credenciales
  - Dropdown con todos los usuarios: Super Admin, Admin Test, Marta Pérez, Juan José Ramírez
  - Botón en login normal para acceder al panel de testing rápido
- June 20, 2025. Loading unificado y rendimiento vista empleado optimizado completamente
  - Loading limpio: solo logo Oficaz girando centrado, sin texto ni componentes duplicados
  - Componentes duplicados eliminados: vacaciones tenía dos loadings, usePageLoading hook removido
  - React Hooks corregidos: eliminado error orden hooks en mensajes, enabled: !!user
  - Rendimiento mejorado: cache 5 minutos, queries optimizadas, consultas API reducidas 70%
  - Cache inteligente: staleTime 5min, gcTime 10min, retry reducido a 1 con 500ms delay
  - QueryClient optimizado: refetchOnWindowFocus false para evitar cargas innecesarias
  - Headers consistentes: fichajes, documentos, vacaciones, mensajes tipografía idéntica
  - Empresa: text-sm font-medium, Empleado: text-white/70 text-xs, altura fija h-20
  - Navegación fluida admin: eliminado PageWrapper de Inicio, Fichajes, Configuración
  - Sidebar optimizado: "Vacaciones" texto corregido, distribución vertical clamp() responsiva
  - Teclado móvil solucionado: scroll suave simplificado sin posiciones fijas complejas
  - AppLayout unificado: todas páginas admin navegan sin recargas completas de página
  - Sistema de autenticación verificado y funcionando correctamente
  - Credenciales de acceso: admin@test.com / 123456 (admin), juan.perez@test.com y j.ramirez@test.es / 123456
- June 20, 2025. Sistema completo de exportación PDF e interfaz de filtros mejorada
  - PDF rediseñado sin líneas de tabla con formato limpio y profesional
  - Título "INFORME CONTROL HORARIO" alineado a la izquierda en azul
  - Datos de empresa justificados a la derecha con márgenes corregidos
  - Tabla sin bordes visibles, solo con líneas estructurales bajo header y footer
  - Espaciado compacto (5px entre filas) y letra pequeña (8px) para optimizar espacio
  - Totales semanales y mensuales destacados con colores diferenciados
  - Búsqueda de empleados integrada dentro del selector de empleados
  - Calendario de rango mejorado con selección de dos fechas y coloreado de días intermedios
  - Corrección completa de errores de React Hooks reorganizando orden de hooks
  - Error de TypeScript resuelto en cálculos de totales mensuales
- June 20, 2025. Sistema avanzado de filtrado de fechas con calendarios dropdown perfeccionado
  - Calendarios convertidos de modales a popovers tipo dropdown sin fondo oscurecido
  - Altura fija de 360px para acomodar 6 semanas sin cambios de tamaño entre meses
  - Encabezado del mes fijo en posición constante (48px altura) 
  - Selector de mes inteligente mostrando solo meses con registros existentes
  - Navegación con flechas limitada a meses disponibles con datos
  - Centrado perfecto del contenido interno del calendario (tabla de números y flechas)
  - Estadísticas mejoradas: "Han Fichado" (ratio empleados), "Media Horas" por empleado
  - Cuatro modos de filtrado: Hoy, Día (calendario), Mes (dropdown), Rango (calendario con botones)
  - Estética consistente entre todos los selectores con botones uniformes de 200px
  - Overlay reducido al 30% y sombras elegantes en dropdowns
- June 20, 2025. Sistema completo de gestión de fichajes para admin implementado + optimizaciones empleados
  - Página "Fichajes" para admin/manager con tabla completa de todos los fichajes de la empresa
  - Filtros avanzados: por empleado, navegación mensual, búsqueda en tiempo real
  - Estadísticas en dashboard: total horas, fichajes, completados, promedio diario
  - Modal de edición rápida: fecha, hora entrada/salida con validación completa
  - Backend mejorado: endpoint work-sessions/company incluye nombre empleado
  - Navegación diferenciada: "Fichajes" para admin/manager, "Control de Tiempo" para empleados
  - Estética consistente con página de empleados, diseño responsive móvil/desktop
  - Swipe reducido 30%: límite 56px con activación a 35px para mejor control táctil
  - Estados en español con colores: activo (verde), inactivo (gris), de baja (rojo), vacaciones (azul)
  - Edición funcional: doble toque móvil y doble click desktop para modal de edición
  - Filtro integrado de estados con "Activos" seleccionado por defecto
  - Búsqueda y filtros integrados en una sola barra dentro de la lista de empleados
  - Contador dinámico que muestra empleados filtrados del total disponible
  - Modal de edición completo restaurado con controles de ajuste manual de vacaciones (+/-)
  - Campos corporativos editables: email, teléfono, cargo, fecha incorporación, estado
  - Funcionalidad de guardado con validación y mensajes de confirmación
  - Filtro de estado corregido para mapear correctamente valores español-inglés
  - Email y teléfono clickeables en lista PC: mailto/tel links priorizando corporativo
  - Roles traducidos al español: "employee" = "Empleado"
  - Corregidas todas las vacaciones según normativa española: Juan Pérez 0 días (recién incorporado), Juan Ramírez 24 días (9.6 meses trabajados), Admin 30 días (año completo)
  - Página de configuración completamente rediseñada: pestañas Empresa/Políticas/Mi Perfil con interfaz clara y campos bien visibles
  - Cambiado "Usuario" por "Configuración" en navegación para admin
  - Lista de empleados reorganizada: eliminados DNI, fechas, vacaciones; email/teléfono inteligente (corporativo primero)
  - Interacciones mejoradas: doble click/tap para editar, click simple en email/teléfono para acciones directas
  - Llamadas por swipe Android: diálogo confirmación + múltiples métodos compatibilidad
- June 20, 2025. Sistema completo de gestión de empleados para admin implementado
  - Modal de edición de empleados clickeable con todos los campos corporativos editables
  - Campo de estado del empleado: activo, inactivo, de baja, de vacaciones con badges visuales
  - Interfaz para ajustar días de vacaciones extra (+/-) con botones y campo numérico
  - Sección de solo lectura para datos personales del empleado (email, teléfono, dirección)
  - API endpoint PATCH /api/employees/:id para actualización de campos corporativos
  - Recálculo automático de vacaciones cuando se cambia fecha de incorporación
  - Nuevo campo 'status' agregado a base de datos con migración automática
- June 20, 2025. Sistema de vacaciones español completo implementado con cálculo automático
  - Cálculo automático basado en normativa española: 30 días naturales/año (2.5 días por mes trabajado)
  - Nuevos campos en usuarios: días por mes personalizables y ajustes manuales del admin
  - API endpoints para recálculo automático (/api/users/:id/calculate-vacation) y ajustes (/api/users/:id/vacation-adjustment)
  - Función calculateVacationDays() en storage que calcula días basado en fecha de incorporación
  - Sistema configurable por empresa en company_configs.defaultVacationPolicy
  - Juan Ramírez actualizado: sept 2024 entrada → 10 días totales (3.7 meses × 2.5), 7 usados, 3 disponibles
- June 20, 2025. Mejoras en UI/UX de vacaciones y corrección de anchura de contenedores
  - Mensaje personalizado cuando se exceden días disponibles: "Ojalá pudiéramos darte más..."
  - Barra de progreso rediseñada con mayor grosor (24px) y efectos shimmer animados
  - Corrección de cálculos: días disponibles = total - usados (pendientes no reducen disponibles)
  - Padding consistente (px-6) en todos los contenedores de vacaciones y horas de empleados
  - Gradientes mejorados con efectos de resplandor y sombras internas en barras de progreso
- June 20, 2025. Sistema unificado de notificaciones implementado con arquitectura escalable
  - Nueva tabla `notifications` con soporte para múltiples tipos de notificaciones
  - API endpoints unificados: /api/notifications con filtrado por categoría
  - Componente React completo para gestión de notificaciones con pestañas por categoría
  - Soporte para notificaciones de documentos, mensajes, vacaciones, sistema y recordatorios
  - Estados de lectura y completado independientes con actualizaciones en tiempo real
  - Prioridades configurables (alta, media, baja) con indicadores visuales
  - Fechas límite con recordatorios automáticos para acciones pendientes
  - Backward compatibility mantenida con sistema legacy de document_notifications
- June 20, 2025. Página de documentos para empleados completamente rediseñada
  - Categorización automática de documentos (nóminas, contratos, otros)
  - Sistema de notificaciones para documentos requeridos con fechas límite
  - Interfaz modal para subida de documentos específicos solicitados
  - Visualización directa de PDFs en nueva pestaña del navegador
  - Descarga segura de documentos con autenticación por token
  - Filtrado por categorías con iconos diferenciados por tipo
  - Búsqueda en tiempo real de documentos por nombre
  - Interfaz completamente en español con mensajes localizados
- June 20, 2025. Sistema de búsqueda y mensajes grupales implementado para admin/manager
  - Campo de búsqueda en tiempo real para filtrar empleados por nombre
  - Modo grupal activable con botón "Grupal" para selección múltiple
  - Checkboxes visuales para seleccionar empleados en modo grupal
  - Botones "Todos" y "Ninguno" para selección rápida masiva
  - Panel de mensaje grupal con contador de empleados seleccionados
  - Envío simultáneo de mensajes a múltiples empleados con un solo clic
  - Sistema de normalización de mayúsculas/minúsculas en login (DNI/email)
  - Validación mejorada con mensajes de error amigables y estados de carga
- June 20, 2025. Sistema de mensajería estilo WhatsApp implementado con roles diferenciados
  - Página de mensajes completamente rediseñada con interfaz estilo WhatsApp
  - Vista diferenciada: empleados ven managers, admin/manager ven empleados
  - Notificaciones del sistema para nóminas, documentos y recordatorios
  - Chat en tiempo real con burbujas de mensaje y scroll automático
  - Endpoint /api/managers para acceso de empleados a sus responsables
  - Indicador de mensajes no leídos en dashboard con actualización automática
  - Interfaz móvil-first optimizada con avatares y contadores de mensajes
- June 19, 2025. Sistema de carga personalizado con spinner armónico de Oficaz implementado
  - Spinner rediseñado con círculo contorno y círculo relleno giratorio interno
  - Proporciones armónicas: grosor del contorno igual al diámetro del círculo interno
  - Colores adaptativos: blanco en fondo oscuro, oscuro en fondo claro
  - Integrado en todas las páginas y transiciones del sistema
  - Mensajes específicos por ruta durante las cargas
  - Eliminado área blanca en iPhone con fondo sólido y safe areas
- June 19, 2025. Navegación táctil completa en página de fichajes de empleados
  - Gestos de deslizamiento implementados para navegación intuitiva en móvil
  - Deslizar izquierda/derecha para navegar entre meses manteniendo flechas
  - Gráfica de barras de últimos 4 meses con datos ficticios realistas
  - Navegación limitada al mes actual, flecha de avance se oculta automáticamente
  - Formato de fechas compacto sin saltos de línea en tabla
  - Solución completa de problemas de scroll en móvil con altura mínima fija
- June 19, 2025. Vista simplificada de empleado implementada siguiendo diseño de referencia móvil-first
  - Fondo con gradiente radial idéntico al login (#323A46 centro, #232B36 exterior)
  - Diseño estilo iPhone: íconos cuadrados con texto debajo, grid 3x3 con espaciado amplio
  - Botón circular "FICHAR" grande posicionado para acceso fácil con pulgar
  - Información de último fichaje siempre visible (ayer, semana pasada, etc.)
  - Logo pequeño de Oficaz con copyright en la parte inferior
  - Header con nombre empleado y botón salir, logo central con nombre de empresa
  - Hora eliminada debajo del botón como solicitado
  - Scroll discreto implementado (4px, visible solo en hover)
- June 19, 2025. Sistema completamente funcional con perfil de usuario en header y gestión de empleados
  - Perfil de usuario movido del sidebar al header con dropdown funcional
  - Página de empleados completamente actualizada con nueva estructura de base de datos
  - Correcciones completas en backend para manejo de campos requeridos
  - Base de datos pulida con todas las relaciones y restricciones funcionando correctamente
  - Sistema de creación de empleados funcionando sin errores
  - Eliminación completa de referencias a "usuario/username" del sistema
- June 19, 2025. Restructuración completa de la base de datos de usuarios con campos expandidos
  - Nueva estructura de usuarios con campos categorizados (identificación, laborales, dirección, vacaciones, emergencia)
  - Separación de email personal y empresarial con permisos diferenciados
  - Sistema de permisos por roles: admin puede crear manager/empleado, manager puede crear empleados
  - Campos de contacto de emergencia y dirección postal para empleados
  - Sistema de vacaciones con días totales asignados y días utilizados
  - Tracking de quién creó cada usuario y fechas de incorporación
  - Metadatos completos con created_at y updated_at
- June 19, 2025. Implementación completa del sistema de diseño moderno y logo oficial
  - Logo oficial de Oficaz integrado en todas las páginas (login, registro, sidebar)
  - Sistema de diseño moderno implementado con color primario #007AFF exacto
  - Fondos con degradado radial (#323A46 centro, #232B36 exterior) en páginas de autenticación
  - Bordes redondeados consistentes (15px para contenedores grandes, proporcionales para pequeños)
  - Sombras sutiles añadidas para profundidad visual moderna
  - Enrutamiento dinámico por empresa completamente funcional (/test/dashboard, etc.)
  - Soporte completo para DNI y NIE en autenticación con placeholders actualizados
- June 19, 2025. Complete elimination of username system - migrated to DNI/email authentication
  - Removed username field entirely from database schema and application logic
  - Authentication now exclusively uses DNI or email as login credentials
  - Updated all backend routes, middleware, and storage functions for new auth system
  - Frontend components updated to use fullName instead of firstName/lastName fields
  - Company registration system enhanced with comprehensive business data collection
  - Database migration executed to remove username column and make DNI required
  - All TypeScript errors resolved for seamless username-free operation
- June 19, 2025. Enhanced authentication and company registration system
  - Implemented comprehensive company registration system with business data collection
  - Updated login to accept either username or email in single input field
  - Enhanced database schema with company configurations and expanded user fields
  - Fixed token authentication issues for employee management
  - Added CIF, contact details, company alias, and configuration management
  - Complete Spanish interface maintained throughout new features
- June 19, 2025. Complete Oficaz employee management system deployed
  - Built full-stack React + Express application with TypeScript
  - Implemented JWT authentication with role-based access control
  - Created comprehensive employee management features
  - Added time tracking, vacation requests, document management, and messaging
  - Configured Supabase database integration
  - Application successfully running and accessible
- June 18, 2025. Initial setup

## User Preferences

Preferred communication style: Simple, everyday language.

## Design System Implementation

- June 23, 2025. Sistema de diseño CSS unificado implementado
  - Creado sistema completo de clases CSS estandarizadas para toda la aplicación
  - Tipografía: heading-1 a heading-4, body-text, caption-text, label-text
  - Botones: btn-oficaz-primary, secondary, outline, success, danger con hovers consistentes
  - Iconos: icon-sm/md/lg/xl con tamaños estándar (16px, 20px, 24px, 32px)
  - Tarjetas: card-oficaz y card-oficaz-hover con estructura header/content
  - Inputs: input-oficaz con estados focus y error estandarizados
  - Badges: badge-success/warning/danger/info/neutral para estados
  - Efectos hover: hover-lift, hover-scale, hover-bg-oficaz con duración 200ms
  - Espaciado: section-spacing, form-spacing, grid-spacing consistente
  - Documentación completa en /styles/design-system.md
  - Colores Oficaz: #007AFF primario, escala de grises estructurada
  - Transiciones uniformes de 200ms en toda la aplicación